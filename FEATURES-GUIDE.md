# UGSã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ã‚¯ãƒ¼ãƒ« æ©Ÿèƒ½ã‚¬ã‚¤ãƒ‰ï¼ˆå®Ÿè£…ç‰ˆï¼‰

> **æœ€çµ‚æ›´æ–°:** 2025-12-01
> **ãƒãƒ¼ã‚¸ãƒ§ãƒ³:** 2.0ï¼ˆå®Ÿè£…ãƒ™ãƒ¼ã‚¹ï¼‰
> **æ³¨æ„:** ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯å®Ÿéš›ã®å®Ÿè£…ã«åŸºã¥ã„ã¦ä½œæˆã•ã‚Œã¦ã„ã¾ã™

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯ã€UGSã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ã‚¯ãƒ¼ãƒ«ã«**å®Ÿéš›ã«å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹**ã™ã¹ã¦ã®æ©Ÿèƒ½ã¨ãã®ä½¿ã„æ–¹ã‚’èª¬æ˜ã—ã¾ã™ã€‚

---

## ğŸ“‹ ç›®æ¬¡

1. [èªè¨¼ãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†](#1-èªè¨¼ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†)
2. [ä¼šå“¡ç•ªå·æ©Ÿèƒ½](#2-ä¼šå“¡ç•ªå·æ©Ÿèƒ½)
3. [æ•™è‚²ã‚³ãƒ³ãƒ†ãƒ³ãƒ„æ©Ÿèƒ½](#3-æ•™è‚²ã‚³ãƒ³ãƒ†ãƒ³ãƒ„æ©Ÿèƒ½)
4. [è³‡æ–™ã‚³ãƒ³ãƒ†ãƒ³ãƒ„æ©Ÿèƒ½](#4-è³‡æ–™ã‚³ãƒ³ãƒ†ãƒ³ãƒ„æ©Ÿèƒ½)
5. [ã‚¤ãƒ™ãƒ³ãƒˆç®¡ç†æ©Ÿèƒ½](#5-ã‚¤ãƒ™ãƒ³ãƒˆç®¡ç†æ©Ÿèƒ½)
6. [é€šçŸ¥æ©Ÿèƒ½](#6-é€šçŸ¥æ©Ÿèƒ½)
7. [å ±é…¬ç®¡ç†æ©Ÿèƒ½](#7-å ±é…¬ç®¡ç†æ©Ÿèƒ½)
8. [ç´¹ä»‹ç®¡ç†æ©Ÿèƒ½](#8-ç´¹ä»‹ç®¡ç†æ©Ÿèƒ½)
9. [æ˜‡æ ¼ç”³è«‹æ©Ÿèƒ½](#9-æ˜‡æ ¼ç”³è«‹æ©Ÿèƒ½)
10. [LPé¢è«‡æ©Ÿèƒ½](#10-lpé¢è«‡æ©Ÿèƒ½)
11. [å¥‘ç´„ç®¡ç†æ©Ÿèƒ½](#11-å¥‘ç´„ç®¡ç†æ©Ÿèƒ½)
12. [åŸºç¤ãƒ†ã‚¹ãƒˆãƒ»ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆ](#12-åŸºç¤ãƒ†ã‚¹ãƒˆã‚¢ãƒ³ã‚±ãƒ¼ãƒˆ)
13. [ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ](#13-ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ)
14. [äº‹å‰ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆæ©Ÿèƒ½](#14-äº‹å‰ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆæ©Ÿèƒ½)
15. [å€‹åˆ¥ç›¸è«‡æ©Ÿèƒ½](#15-å€‹åˆ¥ç›¸è«‡æ©Ÿèƒ½)
16. [FAQãƒ»ãŠå•ã„åˆã‚ã›](#16-faqãŠå•ã„åˆã‚ã›)
17. [ååˆºæ³¨æ–‡æ©Ÿèƒ½](#17-ååˆºæ³¨æ–‡æ©Ÿèƒ½)
18. [ãƒãƒ¼ãƒ ç®¡ç†æ©Ÿèƒ½](#18-ãƒãƒ¼ãƒ ç®¡ç†æ©Ÿèƒ½)
19. [ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ç®¡ç†](#19-ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ç®¡ç†)
20. [ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒ»ã‚¢ã‚«ã‚¦ãƒ³ãƒˆè¨­å®š](#20-ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆè¨­å®š)
21. [ç®¡ç†è€…æ©Ÿèƒ½](#21-ç®¡ç†è€…æ©Ÿèƒ½)

---

## 1. èªè¨¼ãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†

### æ¦‚è¦
Supabase Authã‚’ä½¿ç”¨ã—ãŸå …ç‰¢ãªèªè¨¼ã‚·ã‚¹ãƒ†ãƒ ã€‚4ã¤ã®ãƒ­ãƒ¼ãƒ«ã«ã‚ˆã‚‹æ®µéšçš„ãªæ¨©é™ç®¡ç†ã‚’å®Ÿè£…ã€‚

### ãƒ­ãƒ¼ãƒ«ä½“ç³»

| ãƒ­ãƒ¼ãƒ« | æ¨©é™ | èª¬æ˜ |
|--------|------|------|
| **MEMBER** | åŸºæœ¬ | UGSä¼šå“¡ï¼ˆä¸€èˆ¬ä¼šå“¡ï¼‰ |
| **FP** | æ‹¡å¼µ | FPã‚¨ã‚¤ãƒ‰ï¼ˆç‹¬ç«‹ç³»FPï¼‰ |
| **MANAGER** | ä¸Šç´š | ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ |
| **ADMIN** | å…¨æ¨©é™ | ç®¡ç†è€… |

### ä¼šå“¡ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹

```
PENDING      ä»®ç™»éŒ²ï¼ˆæ±ºæ¸ˆæœªå®Œäº†ï¼‰
  â†“ æ±ºæ¸ˆå®Œäº†
ACTIVE       æœ‰åŠ¹ä¼šå“¡
  â†“ æ±ºæ¸ˆå¤±æ•—
PAST_DUE     æ”¯æ‰•ã„é…å»¶
  â†“ çŒ¶äºˆæœŸé–“çµŒé
DELINQUENT   é•·æœŸæ»ç´
  â†“ ãƒ¦ãƒ¼ã‚¶ãƒ¼é€€ä¼šç”³è«‹
CANCELED     é€€ä¼šæ¸ˆã¿
  â†“ é‹å–¶åˆ¤æ–­
TERMINATED   å¼·åˆ¶è§£ç´„
EXPIRED      æœŸé™åˆ‡ã‚Œ
```

### ä¼šå“¡ç™»éŒ²ãƒ•ãƒ­ãƒ¼

1. **ä»®ç™»éŒ²** (`/register`)
   - åå‰ãƒ»ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ãƒ»ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å…¥åŠ›
   - ç´¹ä»‹ã‚³ãƒ¼ãƒ‰å…¥åŠ›ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰
   - PendingUserãƒ†ãƒ¼ãƒ–ãƒ«ã«ä¿å­˜

2. **ãƒ¡ãƒ¼ãƒ«èªè¨¼**
   - èªè¨¼ãƒªãƒ³ã‚¯é€ä¿¡
   - ãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼ï¼ˆ24æ™‚é–“æœ‰åŠ¹ï¼‰

3. **Supabaseãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆ**
   - ãƒ¡ãƒ¼ãƒ«èªè¨¼å®Œäº†å¾Œã€è‡ªå‹•ä½œæˆ
   - ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ¥åŒ–

4. **æ±ºæ¸ˆ** (`/checkout`)
   - Stripeæ±ºæ¸ˆãƒšãƒ¼ã‚¸ã«é·ç§»
   - ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ç™»éŒ²

5. **æœ¬ç™»éŒ²å®Œäº†**
   - Stripe Webhookå—ä¿¡
   - Userãƒ¬ã‚³ãƒ¼ãƒ‰ä½œæˆ
   - ä¼šå“¡ç•ªå·è‡ªå‹•ä»˜ä¸
   - ç´¹ä»‹ãƒ¬ã‚³ãƒ¼ãƒ‰ä½œæˆï¼ˆç´¹ä»‹çµŒç”±ã®å ´åˆï¼‰

### APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

#### ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘
- `POST /api/auth/create-profile` - ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ä½œæˆ
- `POST /api/auth/reset-password` - ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒªã‚»ãƒƒãƒˆ
- `GET /api/auth/profile/[userId]` - ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å–å¾—
- `PUT /api/user/update-profile` - ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æ›´æ–°
- `POST /api/user/change-password` - ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´

#### ç®¡ç†è€…å‘ã‘
- `GET /api/admin/users` - ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§
- `GET /api/admin/users/[userId]` - ãƒ¦ãƒ¼ã‚¶ãƒ¼è©³ç´°
- `PUT /api/admin/users/[userId]` - ãƒ¦ãƒ¼ã‚¶ãƒ¼æ›´æ–°
- `POST /api/admin/users/role` - ãƒ­ãƒ¼ãƒ«å¤‰æ›´
- `POST /api/admin/users/bulk-membership-status` - ä¸€æ‹¬ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å¤‰æ›´
- `GET /api/admin/users/export` - CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ¢ãƒ‡ãƒ«

```prisma
model User {
  id                      String       @id @default(cuid())
  email                   String       @unique
  name                    String
  role                    UserRole     @default(MEMBER)
  memberId                String?      @unique
  referralCode            String?      @unique
  membershipStatus        MembershipStatus @default(ACTIVE)
  // ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æ‹¡å¼µ
  phone                   String?
  address                 String?
  bio                     String?
  profileImageUrl         String?
  // ... 30ä»¥ä¸Šã®ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
}

model PendingUser {
  id                String   @id
  email             String   @unique
  name              String
  password          String   // ãƒãƒƒã‚·ãƒ¥åŒ–æ¸ˆã¿
  emailVerified     Boolean  @default(false)
  verificationToken String?  @unique
  tokenExpiresAt    DateTime?
}
```

---

## 2. ä¼šå“¡ç•ªå·æ©Ÿèƒ½

### æ¦‚è¦
å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ä¸€æ„ã®ä¼šå“¡ç•ªå·ã‚’è‡ªå‹•ä»˜ä¸ã€‚å•ã„åˆã‚ã›æ™‚ã®æœ¬äººç¢ºèªãªã©ã«ä½¿ç”¨ã€‚

### ä¼šå“¡ç•ªå·ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
```
UGS + 7æ¡ã®é€£ç•ª
ä¾‹: UGS0000001, UGS0000123, UGS9999999
```

### ç”Ÿæˆã‚¿ã‚¤ãƒŸãƒ³ã‚°

1. **æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²æ™‚**
   - Stripe Webhookå—ä¿¡å¾Œã€Userãƒ¬ã‚³ãƒ¼ãƒ‰ä½œæˆæ™‚ã«è‡ªå‹•ç”Ÿæˆ
   - ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å†…ã§é€£ç•ªã‚’å–å¾—ï¼ˆãƒ¬ãƒ¼ã‚¹ã‚³ãƒ³ãƒ‡ã‚£ã‚·ãƒ§ãƒ³å¯¾ç­–æ¸ˆã¿ï¼‰

2. **æ—¢å­˜ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®ä¸€æ‹¬ä»˜ä¸**
   - ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œ: `npx tsx scripts/assign-member-ids.ts`
   - ç™»éŒ²æ—¥æ™‚é †ã«é€£ç•ªã‚’å‰²ã‚Šå½“ã¦

### è¡¨ç¤ºç®‡æ‰€

- **ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«** (`/dashboard/settings/profile`)
  - èª­ã¿å–ã‚Šå°‚ç”¨ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¨ã—ã¦è¡¨ç¤º
  - ã€Œå•ã„åˆã‚ã›æ™‚ã«ã“ã®ç•ªå·ã‚’ãŠä¼ãˆãã ã•ã„ã€ã¨æ¡ˆå†…

- **ç®¡ç†è€…ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§** (`/dashboard/admin/users`)
  - ãƒ¢ãƒã‚¹ãƒšãƒ¼ã‚¹ãƒ•ã‚©ãƒ³ãƒˆã§è¦‹ã‚„ã™ãè¡¨ç¤º
  - ä¼šå“¡ç•ªå·ã§æ¤œç´¢å¯èƒ½

### æ¤œç´¢æ©Ÿèƒ½

ç®¡ç†è€…ç”»é¢ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¤œç´¢ã§ã€ä»¥ä¸‹ã®é …ç›®ã‚’æ¤œç´¢å¯èƒ½:
- åå‰
- ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
- **ä¼šå“¡ç•ªå·** â† NEW

### APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

ä¼šå“¡ç•ªå·ã¯ User ãƒ¢ãƒ‡ãƒ«ã®ä¸€éƒ¨ã¨ã—ã¦å–å¾—ã•ã‚Œã¾ã™ã€‚

### å®Ÿè£…è©³ç´°

```typescript
// src/lib/services/member-id-generator.ts
export async function generateMemberId(): Promise<string> {
  return await prisma.$transaction(async (tx) => {
    // æœ€æ–°ã®ä¼šå“¡ç•ªå·ã‚’å–å¾—
    const latestUser = await tx.user.findFirst({
      where: { memberId: { startsWith: 'UGS' } },
      orderBy: { memberId: 'desc' },
      select: { memberId: true }
    })

    let nextNumber = 1
    if (latestUser?.memberId) {
      const numberPart = latestUser.memberId.replace('UGS', '')
      nextNumber = parseInt(numberPart, 10) + 1
    }

    const paddedNumber = nextNumber.toString().padStart(7, '0')
    return `UGS${paddedNumber}`
  })
}
```

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ¢ãƒ‡ãƒ«

```prisma
model User {
  memberId String? @unique  // UGS0000001å½¢å¼
  // æ³¨: ç¾åœ¨nullableã€å°†æ¥çš„ã«å¿…é ˆåŒ–äºˆå®š
}
```

---

## 3. æ•™è‚²ã‚³ãƒ³ãƒ†ãƒ³ãƒ„æ©Ÿèƒ½

### æ¦‚è¦
æ®µéšçš„ã«å­¦ç¿’ã§ãã‚‹ã‚³ãƒ¼ã‚¹ä½“ç³»ã€‚Vimeoå‹•ç”»ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã§è¦–è´ã—ã€é€²æ—ã‚’è‡ªå‹•ç®¡ç†ã€‚

### ã‚³ãƒ¼ã‚¹ä½“ç³»

#### ã‚«ãƒ†ã‚´ãƒªãƒ¼
- **BASICï¼ˆåŸºç¤ç·¨ï¼‰**: åå…¥ã‚’å¾—ã‚‹ãŸã‚ã®åŸºç¤çŸ¥è­˜
- **PRACTICALï¼ˆå®Ÿè·µç·¨ï¼‰**: ãƒ©ã‚¤ãƒ•ã‚¹ã‚¿ã‚¤ãƒ«å‘ä¸Šã®å®Ÿè·µçŸ¥è­˜
- **ADVANCEDï¼ˆå¿œç”¨ç·¨ï¼‰**: èµ·æ¥­ãƒ»ç‹¬ç«‹ã‚’ç›®æŒ‡ã™é«˜åº¦ãªå†…å®¹

#### ãƒ¬ãƒ™ãƒ«
- **BEGINNERï¼ˆåˆç´šï¼‰**: åˆå¿ƒè€…å‘ã‘
- **INTERMEDIATEï¼ˆä¸­ç´šï¼‰**: çµŒé¨“è€…å‘ã‘
- **ADVANCEDï¼ˆä¸Šç´šï¼‰**: ä¸Šç´šè€…å‘ã‘

### ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™

- **ä¸€èˆ¬å…¬é–‹**: ã™ã¹ã¦ã®ãƒ­ãƒ¼ãƒ«ãŒã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
- **FPã‚¨ã‚¤ãƒ‰é™å®š**: `isLocked: true` ã®ã‚³ãƒ¼ã‚¹ã¯FPä»¥ä¸Šã®ã¿

### æ©Ÿèƒ½è©³ç´°

#### ã‚³ãƒ¼ã‚¹ä¸€è¦§ (`/dashboard/courses`)

è¡¨ç¤ºå†…å®¹:
- ã‚«ãƒ†ã‚´ãƒªãƒ¼åˆ¥ã‚°ãƒ«ãƒ¼ãƒ”ãƒ³ã‚°
- ã‚³ãƒ¼ã‚¹ã‚«ãƒ¼ãƒ‰ï¼ˆã‚¿ã‚¤ãƒˆãƒ«ã€èª¬æ˜ã€ãƒ¬ãƒ™ãƒ«ã€é€²æ—ç‡ï¼‰
- ãƒ­ãƒƒã‚¯çŠ¶æ…‹ã®è¡¨ç¤º
- ã€Œå­¦ç¿’ã‚’å§‹ã‚ã‚‹ã€ãƒœã‚¿ãƒ³

#### ãƒ¬ãƒƒã‚¹ãƒ³è¦–è´ (`/dashboard/learn/[courseId]`)

æ©Ÿèƒ½:
- Vimeoå‹•ç”»ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼
- ãƒ¬ãƒƒã‚¹ãƒ³ä¸€è¦§ï¼ˆã‚µã‚¤ãƒ‰ãƒãƒ¼ï¼‰
- è¦–è´é€²æ—ã®è‡ªå‹•ä¿å­˜
- 90%ä»¥ä¸Šè¦–è´ã§è‡ªå‹•å®Œäº†
- æ¬¡ã®ãƒ¬ãƒƒã‚¹ãƒ³ã¸ã®è‡ªå‹•é·ç§»
- ã‚³ãƒ¼ã‚¹å…¨ä½“ã®é€²æ—ç‡è¡¨ç¤º

#### é€²æ—ç®¡ç†

- ãƒ¬ãƒƒã‚¹ãƒ³ã”ã¨ã®è¦–è´ä½ç½®ã‚’è¨˜éŒ²
- å‹•ç”»ã®90%ä»¥ä¸Šã‚’è¦–è´ã—ãŸã‚‰å®Œäº†
- ã‚³ãƒ¼ã‚¹å®Œäº†ç‡ã‚’è¨ˆç®—ï¼ˆå®Œäº†ãƒ¬ãƒƒã‚¹ãƒ³æ•° Ã· ç·ãƒ¬ãƒƒã‚¹ãƒ³æ•°ï¼‰
- æœ€çµ‚è¦–è´æ—¥æ™‚ã‚’è¨˜éŒ²

### APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

#### ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘
- `GET /api/courses` - ã‚³ãƒ¼ã‚¹ä¸€è¦§ã¨é€²æ—ã‚’å–å¾—
- `GET /api/courses/[courseId]` - ç‰¹å®šã®ã‚³ãƒ¼ã‚¹ã¨ãƒ¬ãƒƒã‚¹ãƒ³ã‚’å–å¾—
- `POST /api/courses/progress` - ãƒ¬ãƒƒã‚¹ãƒ³ã®é€²æ—ã‚’æ›´æ–°

#### ç®¡ç†è€…å‘ã‘
- `GET /api/admin/courses` - ã‚³ãƒ¼ã‚¹ä¸€è¦§
- `POST /api/admin/courses` - ã‚³ãƒ¼ã‚¹ä½œæˆ
- `PUT /api/admin/courses/[courseId]` - ã‚³ãƒ¼ã‚¹æ›´æ–°
- `DELETE /api/admin/courses/[courseId]` - ã‚³ãƒ¼ã‚¹å‰Šé™¤
- `POST /api/admin/courses/[courseId]/lessons` - ãƒ¬ãƒƒã‚¹ãƒ³ä½œæˆ
- `PUT /api/admin/lessons/[lessonId]` - ãƒ¬ãƒƒã‚¹ãƒ³æ›´æ–°
- `DELETE /api/admin/lessons/[lessonId]` - ãƒ¬ãƒƒã‚¹ãƒ³å‰Šé™¤

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ¢ãƒ‡ãƒ«

```prisma
model Course {
  id          String         @id
  title       String
  description String?
  category    CourseCategory // BASIC/PRACTICAL/ADVANCED
  level       CourseLevel    // BEGINNER/INTERMEDIATE/ADVANCED
  isLocked    Boolean        @default(false)
  isPublished Boolean        @default(true)
  order       Int            @default(0)
}

model Lesson {
  id          String  @id
  courseId    String
  title       String
  description String?
  duration    Int
  order       Int
  videoUrl    String?  // Vimeo URL
  pdfUrl      String?
  isPublished Boolean  @default(true)
}

model CourseProgress {
  id             String    @id
  userId         String
  courseId       String
  lessonId       String?
  isCompleted    Boolean   @default(false)
  completedAt    DateTime?
  currentTime    Int?      // å‹•ç”»è¦–è´ä½ç½®ï¼ˆç§’ï¼‰
  videoDuration  Int?
  lastWatchedAt  DateTime?

  @@unique([userId, courseId, lessonId])
}
```

---

## 4. è³‡æ–™ã‚³ãƒ³ãƒ†ãƒ³ãƒ„æ©Ÿèƒ½

### æ¦‚è¦
PDFã‚„ãƒãƒ‹ãƒ¥ã‚¢ãƒ«ãªã©ã®è³‡æ–™ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å¯èƒ½ã€‚ãƒ­ãƒ¼ãƒ«åˆ¥ã«é–²è¦§æ¨©é™ã‚’è¨­å®šã€‚

### ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™

è³‡æ–™ã”ã¨ã«é–²è¦§å¯èƒ½ãƒ­ãƒ¼ãƒ«ã‚’è¨­å®š:
- `allowedRoles: ['ADMIN']` - ç®¡ç†è€…ã®ã¿
- `allowedRoles: ['MANAGER', 'ADMIN']` - ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ä»¥ä¸Š
- `allowedRoles: ['FP', 'MANAGER', 'ADMIN']` - FPã‚¨ã‚¤ãƒ‰ä»¥ä¸Š
- `allowedRoles: ['MEMBER', 'FP', 'MANAGER', 'ADMIN']` - å…¨å“¡

### æ©Ÿèƒ½è©³ç´°

#### è³‡æ–™ä¸€è¦§ (`/dashboard/materials`)

è¡¨ç¤ºå†…å®¹:
- è³‡æ–™ã‚«ãƒ¼ãƒ‰ï¼ˆã‚¿ã‚¤ãƒˆãƒ«ã€èª¬æ˜ã€ã‚«ãƒ†ã‚´ãƒªãƒ¼ï¼‰
- ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã¨ã‚µã‚¤ã‚º
- ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³
- ã‚«ãƒ†ã‚´ãƒªãƒ¼åˆ¥ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼

#### è³‡æ–™ç®¡ç†ï¼ˆç®¡ç†è€…ï¼‰

ç®¡ç†ç”»é¢ (`/dashboard/admin/materials`):
- è³‡æ–™ä¸€è¦§
- æ–°è¦è¿½åŠ 
- ç·¨é›†ãƒ»å‰Šé™¤
- é–²è¦§å¯èƒ½ãƒ­ãƒ¼ãƒ«è¨­å®š
- ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼ˆSupabase Storageï¼‰

### è³‡æ–™ã®ç¨®é¡

- **ãƒãƒ‹ãƒ¥ã‚¢ãƒ«**: UGSã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã‚¹ã‚¯ãƒ¼ãƒ«ã®ä½¿ã„æ–¹ã€FPã‚¨ã‚¤ãƒ‰æ´»å‹•ãƒãƒ‹ãƒ¥ã‚¢ãƒ«
- **åˆ¶åº¦èª¬æ˜**: ç´¹ä»‹åˆ¶åº¦ã€å ±é…¬åˆ¶åº¦ã®èª¬æ˜è³‡æ–™
- **ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ**: æ˜‡æ ¼ç”³è«‹æ›¸é¡ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
- **ãã®ä»–**: å„ç¨®å‚è€ƒè³‡æ–™

### APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

#### ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘
- `GET /api/materials` - ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ãªè³‡æ–™ä¸€è¦§
- `GET /api/materials/[materialId]` - è³‡æ–™è©³ç´°

#### ç®¡ç†è€…å‘ã‘
- `GET /api/admin/materials` - ã™ã¹ã¦ã®è³‡æ–™ä¸€è¦§
- `POST /api/admin/materials` - è³‡æ–™ä½œæˆ
- `PUT /api/admin/materials/[materialId]` - è³‡æ–™æ›´æ–°
- `DELETE /api/admin/materials/[materialId]` - è³‡æ–™å‰Šé™¤
- `POST /api/admin/materials/upload` - ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ¢ãƒ‡ãƒ«

```prisma
model Material {
  id           String     @id
  title        String
  description  String?
  category     String?
  fileUrl      String
  fileType     String
  fileSize     Int
  allowedRoles UserRole[]
  createdAt    DateTime   @default(now())
  updatedAt    DateTime   @updatedAt
}
```

---

## 5. ã‚¤ãƒ™ãƒ³ãƒˆç®¡ç†æ©Ÿèƒ½

### æ¦‚è¦
ã‚ªãƒ³ãƒ©ã‚¤ãƒ³/ã‚ªãƒ•ãƒ©ã‚¤ãƒ³/ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰å½¢å¼ã®ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç®¡ç†ã€‚æœ‰æ–™ã‚¤ãƒ™ãƒ³ãƒˆå¯¾å¿œã€å‡ºå¸­ç¢ºèªæ©Ÿèƒ½ã‚’å®Ÿè£…ã€‚

### ã‚¤ãƒ™ãƒ³ãƒˆå½¢å¼

- **ONLINE**: ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã®ã¿ï¼ˆZoomç­‰ï¼‰
- **OFFLINE**: ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã®ã¿ï¼ˆä¼šå ´é–‹å‚¬ï¼‰
- **HYBRID**: ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ï¼ˆä¸¡æ–¹ï¼‰

### å‚åŠ è¨­å®š

- **REQUIREDï¼ˆå¿…é ˆï¼‰**: å¯¾è±¡ãƒ­ãƒ¼ãƒ«ã¯å‚åŠ å¿…é ˆ
- **OPTIONALï¼ˆä»»æ„ï¼‰**: è‡ªç”±å‚åŠ 

### å¯¾è±¡ãƒ­ãƒ¼ãƒ«

- **MEMBER**: UGSä¼šå“¡ã®ã¿
- **FP**: FPã‚¨ã‚¤ãƒ‰ã®ã¿
- **MANAGER**: ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã®ã¿
- **ALL**: å…¨å“¡

### æ©Ÿèƒ½è©³ç´°

#### ã‚¤ãƒ™ãƒ³ãƒˆä¸€è¦§ (`/dashboard/events`)

**å®Ÿè£…çŠ¶æ³:**
- âœ… ã‚¤ãƒ™ãƒ³ãƒˆã‚«ãƒ¼ãƒ‰è¡¨ç¤º
- âœ… æ—¥æ™‚ãƒ»å ´æ‰€ãƒ»å¯¾è±¡ãƒ­ãƒ¼ãƒ«è¡¨ç¤º
- âœ… å‚åŠ ç™»éŒ²ãƒœã‚¿ãƒ³
- âœ… å‚åŠ æ¸ˆã¿è¡¨ç¤º
- âœ… æœ‰æ–™ã‚¤ãƒ™ãƒ³ãƒˆã®ä¾¡æ ¼è¡¨ç¤º
- âŒ **ã‚¤ãƒ™ãƒ³ãƒˆè©³ç´°ãƒšãƒ¼ã‚¸ã¸ã®ãƒªãƒ³ã‚¯ï¼ˆæœªå®Ÿè£…ï¼‰**

**è¡¨ç¤ºã•ã‚Œã‚‹æƒ…å ±:**
- ã‚¿ã‚¤ãƒˆãƒ«
- æ—¥æ™‚
- å ´æ‰€ï¼ˆã‚ªãƒ³ãƒ©ã‚¤ãƒ³/ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ï¼‰
- å‚åŠ äººæ•° / å®šå“¡
- å‚åŠ ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼ˆæœªç™»éŒ²/ç™»éŒ²æ¸ˆã¿/å‡ºå¸­å®Œäº†ï¼‰
- æœ‰æ–™ã‚¤ãƒ™ãƒ³ãƒˆã®ä¾¡æ ¼

#### ã‚¤ãƒ™ãƒ³ãƒˆè©³ç´°ãƒšãƒ¼ã‚¸

**âš ï¸ é‡è¦ãªå•é¡Œç‚¹:**
ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ã®ã‚¤ãƒ™ãƒ³ãƒˆè©³ç´°ãƒšãƒ¼ã‚¸ (`/dashboard/events/[eventId]`) ãŒ**å®Ÿè£…ã•ã‚Œã¦ã„ã¾ã›ã‚“**ã€‚

ç¾çŠ¶:
- ã‚¤ãƒ™ãƒ³ãƒˆä¸€è¦§ã§ã‚«ãƒ¼ãƒ‰è¡¨ç¤ºã®ã¿
- ã‚¯ãƒªãƒƒã‚¯ã—ã¦è©³ç´°ã‚’è¦‹ã‚‹ã“ã¨ãŒã§ããªã„
- é€šçŸ¥ã‹ã‚‰ã®ãƒªãƒ³ã‚¯ã‚‚ä¸€è¦§ãƒšãƒ¼ã‚¸ã«é·ç§»

å½±éŸ¿:
- ã‚¤ãƒ™ãƒ³ãƒˆã®è©³ç´°èª¬æ˜ã‚’ç¢ºèªã§ããªã„
- éå»ã‚¤ãƒ™ãƒ³ãƒˆã®å†™çœŸãƒ»è³‡æ–™ã‚’é–²è¦§ã§ããªã„
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½“é¨“ã«é‡å¤§ãªå½±éŸ¿

â†’ **é«˜å„ªå…ˆåº¦ã§å®Ÿè£…ãŒå¿…è¦**ï¼ˆå¾Œè¿°ã®ä¿®æ­£ã§å¯¾å¿œï¼‰

#### ã‚¤ãƒ™ãƒ³ãƒˆä½œæˆãƒ»ç®¡ç†ï¼ˆç®¡ç†è€…ï¼‰

ç®¡ç†ç”»é¢ (`/dashboard/admin/events`):
- ã‚¤ãƒ™ãƒ³ãƒˆä½œæˆ
- åŸºæœ¬æƒ…å ±è¨­å®šï¼ˆã‚¿ã‚¤ãƒˆãƒ«ã€æ—¥æ™‚ã€å ´æ‰€ï¼‰
- å¯¾è±¡ãƒ­ãƒ¼ãƒ«é¸æŠï¼ˆè¤‡æ•°å¯ï¼‰
- å‚åŠ è¨­å®šï¼ˆå¿…é ˆ/ä»»æ„ï¼‰
- é–‹å‚¬å½¢å¼ï¼ˆã‚ªãƒ³ãƒ©ã‚¤ãƒ³/ã‚ªãƒ•ãƒ©ã‚¤ãƒ³/ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ï¼‰
- æœ‰æ–™ã‚¤ãƒ™ãƒ³ãƒˆè¨­å®šï¼ˆä¾¡æ ¼ã€Stripeé€£æºï¼‰
- ã‚µãƒ ãƒã‚¤ãƒ«ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
- å‚åŠ è€…ä¸€è¦§è¡¨ç¤º
- ä¸€æ‹¬ãƒ¡ãƒ¼ãƒ«é€ä¿¡

#### æœ‰æ–™ã‚¤ãƒ™ãƒ³ãƒˆ

æ©Ÿèƒ½:
- Stripeé€£æºã§æ±ºæ¸ˆå‡¦ç†
- æ±ºæ¸ˆå®Œäº†å¾Œã«å‚åŠ ç¢ºå®š
- æ±ºæ¸ˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç®¡ç†ï¼ˆPENDING/PAID/REFUNDEDï¼‰
- ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãƒ»è¿”é‡‘æ©Ÿèƒ½

#### å‡ºå¸­ç¢ºèªã‚·ã‚¹ãƒ†ãƒ 

2ã¤ã®æ–¹æ³•ã§å‡ºå¸­ã‚’ç¢ºèª:

**æ–¹æ³•1: å‚åŠ ã‚³ãƒ¼ãƒ‰å…¥åŠ›**
- ç”¨é€”: ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆã€ãƒ©ã‚¤ãƒ–å‚åŠ è€…
- æµã‚Œ:
  1. ç®¡ç†è€…ãŒå‚åŠ ã‚³ãƒ¼ãƒ‰ã‚’è¨­å®šï¼ˆã‚¢ãƒ«ãƒ•ã‚¡ãƒ™ãƒƒãƒˆï¼‰
  2. ã‚¤ãƒ™ãƒ³ãƒˆå½“æ—¥ã€ä¼šå ´ã§å‚åŠ ã‚³ãƒ¼ãƒ‰ã‚’å‘ŠçŸ¥
  3. å‚åŠ è€…ãŒã‚³ãƒ¼ãƒ‰å…¥åŠ›
  4. è‡ªå‹•çš„ã«å‡ºå¸­å®Œäº†

**æ–¹æ³•2: éŒ²ç”»è¦–è´+ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆ**
- ç”¨é€”: å¾Œæ—¥è¦–è´è€…
- æµã‚Œ:
  1. ç®¡ç†è€…ãŒVimeoéŒ²ç”»URLã¨ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆURLã‚’è¨­å®š
  2. å‚åŠ è€…ãŒéŒ²ç”»ã‚’è¦–è´
  3. ã€Œè¦–è´å®Œäº†ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯
  4. ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆã«å›ç­”
  5. ä¸¡æ–¹å®Œäº†ã§å‡ºå¸­å®Œäº†

#### å®šæœŸé–‹å‚¬ã‚¤ãƒ™ãƒ³ãƒˆ

æ©Ÿèƒ½:
- æœˆæ¬¡è‡ªå‹•ç”Ÿæˆï¼ˆCron Jobï¼‰
- ãƒ‘ã‚¿ãƒ¼ãƒ³è¨­å®šï¼ˆä¾‹: æ¯æœˆç¬¬1æ—¥æ›œæ—¥ï¼‰
- `/api/cron/generate-monthly-events` ã§è‡ªå‹•å®Ÿè¡Œ

#### éå»ã‚¤ãƒ™ãƒ³ãƒˆè¨˜éŒ²ï¼ˆã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ï¼‰

ç®¡ç†è€…ãŒè¨˜éŒ²ã§ãã‚‹å†…å®¹:
- å®Ÿæ–½å†…å®¹ã®æ¦‚è¦
- å½“æ—¥ã®å†™çœŸï¼ˆè¤‡æ•°ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼‰
- ã‚»ãƒŸãƒŠãƒ¼è³‡æ–™ãƒªãƒ³ã‚¯
- å®Ÿå‚åŠ äººæ•°
- æœ€çµ‚çš„ãªä¼šå ´æƒ…å ±
- ç®¡ç†è€…ãƒ¡ãƒ¢

è¨˜éŒ²å°‚ç”¨ãƒ¢ãƒ¼ãƒ‰:
- `isArchiveOnly: true` ã§è¨˜éŒ²ã®ã¿ï¼ˆå‚åŠ å‹Ÿé›†ãªã—ï¼‰

### APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

#### ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘
- `GET /api/events` - ã‚¤ãƒ™ãƒ³ãƒˆä¸€è¦§ï¼ˆãƒ­ãƒ¼ãƒ«åˆ¥ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°æ¸ˆã¿ï¼‰
- `POST /api/events/register` - å‚åŠ ç™»éŒ²
- `POST /api/events/cancel` - ã‚­ãƒ£ãƒ³ã‚»ãƒ«
- `POST /api/events/checkout` - æœ‰æ–™ã‚¤ãƒ™ãƒ³ãƒˆæ±ºæ¸ˆ
- `POST /api/events/verify-payment` - æ±ºæ¸ˆç¢ºèª
- `POST /api/events/submit-attendance-code` - å‚åŠ ã‚³ãƒ¼ãƒ‰æå‡º
- `POST /api/events/mark-video-watched` - éŒ²ç”»è¦–è´å®Œäº†
- `POST /api/events/mark-survey-completed` - ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆå®Œäº†

#### ç®¡ç†è€…å‘ã‘
- `GET /api/admin/events` - ã‚¤ãƒ™ãƒ³ãƒˆä¸€è¦§
- `POST /api/admin/events` - ã‚¤ãƒ™ãƒ³ãƒˆä½œæˆ
- `PUT /api/admin/events/[eventId]` - ã‚¤ãƒ™ãƒ³ãƒˆæ›´æ–°
- `DELETE /api/admin/events/[eventId]` - ã‚¤ãƒ™ãƒ³ãƒˆå‰Šé™¤
- `GET /api/admin/events/[eventId]/participants` - å‚åŠ è€…ä¸€è¦§
- `POST /api/admin/events/[eventId]/send-email` - ãƒ¡ãƒ¼ãƒ«é€ä¿¡
- `POST /api/admin/events/generate-recurring` - å®šæœŸã‚¤ãƒ™ãƒ³ãƒˆç”Ÿæˆ
- `POST /api/admin/events/upload-thumbnail` - ã‚µãƒ ãƒã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
- `POST /api/admin/events/upload-photo` - å†™çœŸã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼ˆéå»ã‚¤ãƒ™ãƒ³ãƒˆï¼‰

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ¢ãƒ‡ãƒ«

```prisma
model Event {
  id              String              @id
  title           String
  description     String?
  date            DateTime
  time            String?
  targetRoles     EventTargetRole[]
  attendanceType  EventAttendanceType
  venueType       EventVenueType
  location        String?
  maxParticipants Int?
  status          EventStatus
  thumbnailUrl    String?
  // æœ‰æ–™ã‚¤ãƒ™ãƒ³ãƒˆ
  isPaid          Boolean             @default(false)
  price           Int?
  stripePriceId   String?
  // å‡ºå¸­ç¢ºèª
  attendanceCode  String?
  vimeoUrl        String?
  surveyUrl       String?
  attendanceDeadline DateTime?
  // å®šæœŸé–‹å‚¬
  isRecurring     Boolean             @default(false)
  recurrencePattern String?
  // ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–
  summary         String?
  photos          String[]
  materialsUrl    String?
  actualParticipants Int?
  adminNotes      String?
  isArchiveOnly   Boolean             @default(false)
}

model EventRegistration {
  id                     String              @id
  userId                 String
  eventId                String
  paymentStatus          EventPaymentStatus
  attendanceMethod       AttendanceMethod?
  attendanceCompletedAt  DateTime?
  videoWatched           Boolean             @default(false)
  surveyCompleted        Boolean             @default(false)

  @@unique([userId, eventId])
}
```

---

## 6. é€šçŸ¥æ©Ÿèƒ½

### æ¦‚è¦
å¤šå±¤çš„ãªé€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ ã§é‡è¦æƒ…å ±ã‚’ç¢ºå®Ÿã«ä¼é”ã€‚å€‹åˆ¥é€šçŸ¥ã¨ã‚·ã‚¹ãƒ†ãƒ é€šçŸ¥ã®2ç¨®é¡ã€‚

### é€šçŸ¥ã®ç¨®é¡

#### å€‹åˆ¥é€šçŸ¥ï¼ˆNotificationãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰

ãƒ¦ãƒ¼ã‚¶ãƒ¼å€‹äººã«é€ã‚‰ã‚Œã‚‹é€šçŸ¥ï¼ˆ14ç¨®é¡ï¼‰:

**æ˜‡æ ¼é–¢é€£:**
- `PROMOTION_ELIGIBLE` - æ˜‡æ ¼æ¡ä»¶é”æˆ
- `PROMOTION_APPROVED` - æ˜‡æ ¼æ‰¿èª
- `PROMOTION_REJECTED` - æ˜‡æ ¼å´ä¸‹

**å ±é…¬é–¢é€£:**
- `COMPENSATION_READY` - å ±é…¬ç¢ºå®š
- `COMPENSATION_PAID` - å ±é…¬æ”¯æ‰•ã„å®Œäº†

**ã‚¤ãƒ™ãƒ³ãƒˆé–¢é€£:**
- `EVENT_REMINDER` - ã‚¤ãƒ™ãƒ³ãƒˆãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼
- `EVENT_REQUIRED` - å¿…é ˆã‚¤ãƒ™ãƒ³ãƒˆé€šçŸ¥

**ãã®ä»–:**
- `CONTRACT_ACHIEVED` - å¥‘ç´„é”æˆ
- `REFERRAL_REWARDED` - ç´¹ä»‹å ±é…¬
- `ACTION_REQUIRED` - ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å¿…è¦
- `LP_MEETING_REQUESTED` - LPé¢è«‡ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
- `LP_MEETING_SCHEDULED` - LPé¢è«‡ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ç¢ºå®š
- `LP_MEETING_COMPLETED` - LPé¢è«‡å®Œäº†
- `LP_MEETING_REMINDER` - LPé¢è«‡ãƒªãƒã‚¤ãƒ³ãƒ€ãƒ¼

#### ã‚·ã‚¹ãƒ†ãƒ é€šçŸ¥ï¼ˆSystemNotificationãƒ†ãƒ¼ãƒ–ãƒ«ï¼‰

å…¨ä½“ã¾ãŸã¯ãƒ­ãƒ¼ãƒ«åˆ¥ã«é…ä¿¡ã•ã‚Œã‚‹é€šçŸ¥:

- `EVENT_ADDED` - æ–°ã—ã„ã‚¤ãƒ™ãƒ³ãƒˆè¿½åŠ 
- `MATERIAL_ADDED` - æ–°ã—ã„è³‡æ–™è¿½åŠ 
- `COURSE_ADDED` - æ–°ã—ã„ã‚³ãƒ¼ã‚¹è¿½åŠ 
- `LESSON_ADDED` - æ–°ã—ã„ãƒ¬ãƒƒã‚¹ãƒ³è¿½åŠ 

### å„ªå…ˆåº¦

- **CRITICAL**: é‡è¦ï¼ˆèµ¤è‰²è¡¨ç¤ºï¼‰
- **INFO**: æƒ…å ±ï¼ˆé’è‰²è¡¨ç¤ºï¼‰
- **SUCCESS**: æˆåŠŸï¼ˆç·‘è‰²è¡¨ç¤ºï¼‰

### æ©Ÿèƒ½è©³ç´°

#### é€šçŸ¥ãƒãƒ¼ï¼ˆãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ä¸Šéƒ¨ï¼‰

å®Ÿè£…å ´æ‰€: `src/components/NotificationBar.tsx`

æ©Ÿèƒ½:
- æœ€æ–°ã®æœªèª­ã‚·ã‚¹ãƒ†ãƒ é€šçŸ¥ã‚’1ä»¶è¡¨ç¤º
- NEWãƒãƒƒã‚¸è¡¨ç¤º
- ã‚¯ãƒªãƒƒã‚¯ã§è©³ç´°ãƒšãƒ¼ã‚¸ã«é·ç§»
- é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³ã§æ—¢èª­åŒ–

**ç¾åœ¨ã®é·ç§»å…ˆ:**
- ã‚¤ãƒ™ãƒ³ãƒˆé€šçŸ¥: `/dashboard/events`ï¼ˆä¸€è¦§ãƒšãƒ¼ã‚¸ï¼‰
- â€»ã‚¤ãƒ™ãƒ³ãƒˆè©³ç´°ãƒšãƒ¼ã‚¸ãŒæœªå®Ÿè£…ã®ãŸã‚

#### é€šçŸ¥ä¸€è¦§ (`/dashboard/notifications`)

è¡¨ç¤ºå†…å®¹:
- æœªèª­é€šçŸ¥ã‚»ã‚¯ã‚·ãƒ§ãƒ³
- æ—¢èª­é€šçŸ¥ã‚»ã‚¯ã‚·ãƒ§ãƒ³
- å„ªå…ˆåº¦åˆ¥ã‚¢ã‚¤ã‚³ãƒ³ãƒ»è‰²åˆ†ã‘
- ã‚¢ã‚¯ã‚·ãƒ§ãƒ³URLã¸ã®ãƒªãƒ³ã‚¯
- å€‹åˆ¥æ—¢èª­ãƒœã‚¿ãƒ³
- ã€Œã™ã¹ã¦æ—¢èª­ã«ã™ã‚‹ã€ãƒœã‚¿ãƒ³

#### æ–°ç€ãƒãƒƒã‚¸æ©Ÿèƒ½

ã‚«ãƒ†ã‚´ãƒªã”ã¨ã«æ–°ç€ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã‚’è¡¨ç¤º:

**å¯¾è±¡ã‚«ãƒ†ã‚´ãƒª:**
- `EVENTS` - ã‚¤ãƒ™ãƒ³ãƒˆ
- `COURSES` - ã‚³ãƒ¼ã‚¹
- `MATERIALS` - è³‡æ–™
- `NOTIFICATIONS` - é€šçŸ¥

**ä»•çµ„ã¿:**
- `UserCategoryView` ãƒ†ãƒ¼ãƒ–ãƒ«ã§æœ€çµ‚é–²è¦§æ—¥æ™‚ã‚’è¨˜éŒ²
- æœ€çµ‚é–²è¦§ä»¥é™ã«è¿½åŠ ã•ã‚ŒãŸã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã«NEWãƒãƒƒã‚¸è¡¨ç¤º
- ãƒšãƒ¼ã‚¸ã‚’é–‹ãã¨è‡ªå‹•çš„ã«é–²è¦§æ¸ˆã¿ã¨ã—ã¦ãƒãƒ¼ã‚¯

### ãƒ­ãƒ¼ãƒ«ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°

ã‚·ã‚¹ãƒ†ãƒ é€šçŸ¥ã¯å¯¾è±¡ãƒ­ãƒ¼ãƒ«ã‚’æŒ‡å®šå¯èƒ½:

```typescript
// ã‚¤ãƒ™ãƒ³ãƒˆä½œæˆæ™‚ã®é€šçŸ¥
targetRoles: ['MEMBER']  // UGSä¼šå“¡ã®ã¿
targetRoles: ['FP', 'MANAGER']  // FPã‚¨ã‚¤ãƒ‰ãƒ»ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼
targetRoles: []  // å…¨å“¡å‘ã‘ï¼ˆç©ºé…åˆ—ï¼‰
```

**å®Ÿè£…çŠ¶æ³:**
- âœ… ãƒ­ãƒ¼ãƒ«ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ãƒ­ã‚¸ãƒƒã‚¯å®Ÿè£…æ¸ˆã¿
- âœ… ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°è¿½åŠ ï¼ˆæ¤œè¨¼ç”¨ï¼‰
- âš ï¸ å®Ÿéš›ã®å‹•ä½œã¯æœ¬ç•ªç’°å¢ƒã§è¦ç¢ºèª

### APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

#### ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘
- `GET /api/notifications` - é€šçŸ¥ä¸€è¦§
- `GET /api/notifications/latest` - æœ€æ–°ã®æœªèª­é€šçŸ¥
- `POST /api/notifications/[id]/read` - å€‹åˆ¥æ—¢èª­
- `POST /api/notifications/mark-all-read` - å…¨ã¦æ—¢èª­
- `GET /api/new-badge/status` - æ–°ç€ãƒãƒƒã‚¸çŠ¶æ³
- `POST /api/new-badge/mark-viewed` - ã‚«ãƒ†ã‚´ãƒªé–²è¦§è¨˜éŒ²

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ¢ãƒ‡ãƒ«

```prisma
model Notification {
  id        String               @id
  userId    String
  type      NotificationType
  priority  NotificationPriority
  title     String
  message   String
  actionUrl String?
  isRead    Boolean              @default(false)
  readAt    DateTime?
  createdAt DateTime             @default(now())
}

model SystemNotification {
  id          String                  @id
  type        SystemNotificationType
  title       String
  contentType ContentType?
  contentId   String?
  targetUrl   String?
  targetRoles UserRole[]
  isActive    Boolean                 @default(true)
  createdAt   DateTime                @default(now())
}

model UserNotificationRead {
  id             String   @id
  userId         String
  notificationId String
  readAt         DateTime @default(now())

  @@unique([userId, notificationId])
}

model UserCategoryView {
  id         String      @id
  userId     String
  category   ContentType
  lastViewed DateTime    @default(now())

  @@unique([userId, category])
}
```

---

## 7. å ±é…¬ç®¡ç†æ©Ÿèƒ½

### æ¦‚è¦
é€æ˜æ€§ã®é«˜ã„å ±é…¬è¨ˆç®—ãƒ»ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã€‚CSVä¸€æ‹¬ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¯¾å¿œã€‚

### å ±é…¬è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯

ç¾åœ¨ã®å®Ÿè£…:
```typescript
interface CompensationBreakdown {
  memberReferral: number  // UGSä¼šå“¡ç´¹ä»‹å ±é…¬ï¼ˆç¾åœ¨ç„¡åŠ¹åŒ–ï¼‰
  fpReferral: number      // FPã‚¨ã‚¤ãƒ‰ç´¹ä»‹å ±é…¬ï¼ˆç¾åœ¨ç„¡åŠ¹åŒ–ï¼‰
  contract: number        // å¥‘ç´„å ±é…¬ï¼ˆä¸»è¦ï¼‰
  bonus: number           // ãƒœãƒ¼ãƒŠã‚¹
  deduction: number       // æ§é™¤
}
```

**æ³¨æ„:**
- ç´¹ä»‹å ±é…¬æ©Ÿèƒ½ã¯å®Ÿè£…ã•ã‚Œã¦ã„ã¾ã™ãŒã€ç¾åœ¨ç„¡åŠ¹åŒ–ã•ã‚Œã¦ã„ã¾ã™
- å¥‘ç´„å ±é…¬ãŒä¸»ãªåå…¥æº

### å ±é…¬ãƒ•ãƒ­ãƒ¼

```
1. CSVä¸€æ‹¬ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼ˆå¥‘ç´„ãƒ‡ãƒ¼ã‚¿ï¼‰
   â†“
2. è‡ªå‹•å ±é…¬è¨ˆç®—ï¼ˆPENDINGï¼‰
   â†“
3. ç®¡ç†è€…ç¢ºèªãƒ»æ‰¿èªï¼ˆCONFIRMEDï¼‰
   â†“
4. æ”¯æ‰•ã„å®Œäº†ï¼ˆPAIDï¼‰
   â†“
5. ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é€šçŸ¥
```

### æ©Ÿèƒ½è©³ç´°

#### å ±é…¬ä¸€è¦§ (`/dashboard/compensation`)

è¡¨ç¤ºå†…å®¹:
- æœˆåˆ¥å ±é…¬ä¸€è¦§
- å ±é…¬é¡
- å†…è¨³ï¼ˆå¥‘ç´„å ±é…¬ã€ãƒœãƒ¼ãƒŠã‚¹ã€æ§é™¤ï¼‰
- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼ˆPENDING/CONFIRMED/PAIDï¼‰
- è©³ç´°ãƒœã‚¿ãƒ³

#### å ±é…¬ç®¡ç†ï¼ˆç®¡ç†è€…ï¼‰ (`/dashboard/admin/compensations`)

æ©Ÿèƒ½:
- å ±é…¬ä¸€è¦§ï¼ˆå…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼‰
- æœˆæ¬¡å ±é…¬è‡ªå‹•ç”Ÿæˆ
- CSVä¸€æ‹¬ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
- å€‹åˆ¥æ‰¿èª
- ä¸€æ‹¬æ”¯æ‰•ã„å®Œäº†
- ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ï¼ˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã€æœˆã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼‰

#### CSVä¸€æ‹¬ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰

æ‰‹é †:
1. CSVãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ
2. ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤ºï¼ˆã‚¨ãƒ©ãƒ¼ãƒã‚§ãƒƒã‚¯ï¼‰
3. ç¢ºå®šãƒœã‚¿ãƒ³
4. å¥‘ç´„ãƒ‡ãƒ¼ã‚¿ç™»éŒ²
5. å ±é…¬è‡ªå‹•è¨ˆç®—

CSVãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ:
```csv
ãƒ¦ãƒ¼ã‚¶ãƒ¼ID,å¥‘ç´„ç•ªå·,å•†å“å,å¥‘ç´„æ—¥,é‡‘é¡
```

#### å£åº§æƒ…å ±ç®¡ç†

ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç™»éŒ²å¯èƒ½:
- éŠ€è¡Œå
- æ”¯åº—åãƒ»æ”¯åº—ç•ªå·
- å£åº§ç¨®åˆ¥ï¼ˆæ™®é€š/å½“åº§/è²¯è“„ï¼‰
- å£åº§ç•ªå·
- å£åº§åç¾©

**ã‚†ã†ã¡ã‚‡éŠ€è¡Œç‰¹åˆ¥å¯¾å¿œ:**
- è¨˜å·ãƒ»ç•ªå·å…¥åŠ›
- è‡ªå‹•çš„ã«åº—ç•ªãƒ»å£åº§ç•ªå·ã«å¤‰æ›

### æ˜‡æ ¼æ¡ä»¶ã¨ã®é€£æº

ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼æ˜‡æ ¼æ¡ä»¶:
- **ç›´è¿‘6ãƒ¶æœˆå¹³å‡**: 70,000å††ä»¥ä¸Š

è¨ˆç®—æ–¹æ³•:
```typescript
const recentCompensations = await prisma.compensation.findMany({
  where: {
    userId,
    status: 'PAID',
    month: { gte: sixMonthsAgo }
  }
})

const avgCompensation = sum(compensations) / 6
```

### APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

#### ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘
- `GET /api/compensations` - å ±é…¬ä¸€è¦§
- `POST /api/user/bank-account` - å£åº§æƒ…å ±ç™»éŒ²

#### ç®¡ç†è€…å‘ã‘
- `GET /api/admin/compensations` - å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å ±é…¬ä¸€è¦§
- `POST /api/admin/compensations/generate` - æœˆæ¬¡å ±é…¬ç”Ÿæˆ
- `POST /api/admin/compensations/[compensationId]/approve` - æ‰¿èª
- `POST /api/admin/compensations/[compensationId]/pay` - æ”¯æ‰•ã„å®Œäº†
- `POST /api/admin/compensations/upload/preview` - CSVãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
- `POST /api/admin/compensations/upload/confirm` - CSVç¢ºå®š

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ¢ãƒ‡ãƒ«

```prisma
model Compensation {
  id            String             @id
  userId        String
  month         String             // YYYY-MMå½¢å¼
  amount        Int
  breakdown     Json               // å ±é…¬å†…è¨³
  contractCount Int                @default(0)
  earnedAsRole  UserRole           @default(FP)
  status        CompensationStatus
  createdAt     DateTime           @default(now())
  updatedAt     DateTime           @updatedAt

  @@unique([userId, month])
}

model BankAccount {
  id                String      @id
  userId            String      @unique
  bankName          String
  branchName        String?
  branchNumber      String?
  accountType       AccountType
  accountNumber     String
  accountHolderName String
  // ã‚†ã†ã¡ã‚‡å°‚ç”¨
  isYuchoBank       Boolean     @default(false)
  yuchoSymbol       String?
  yuchoNumber       String?
}

model Contract {
  id             String         @id
  userId         String
  contractNumber String         @unique
  productName    String?
  contractType   ContractType
  status         ContractStatus
  signedAt       DateTime
  amount         Int?
  rewardAmount   Int?
}
```

---

## 8. ç´¹ä»‹ç®¡ç†æ©Ÿèƒ½

### æ¦‚è¦
ç´¹ä»‹ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®è¿½è·¡ã‚·ã‚¹ãƒ†ãƒ ã€‚ç´¹ä»‹ã‚³ãƒ¼ãƒ‰ã‚’ä½¿ç”¨ã—ãŸãƒªãƒ³ã‚¯ç™ºè¡Œå½¢å¼ã€‚

### ç´¹ä»‹ã‚³ãƒ¼ãƒ‰

å„ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«è‡ªå‹•ç”Ÿæˆ:
- ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ: 8æ–‡å­—ã®ãƒ©ãƒ³ãƒ€ãƒ è‹±æ•°å­—
- ä¾‹: `AB12CD34`, `XY98ZW76`
- ãƒ¦ãƒ‹ãƒ¼ã‚¯åˆ¶ç´„ã§é‡è¤‡ãªã—

### ç´¹ä»‹ãƒ•ãƒ­ãƒ¼

```
1. ç´¹ä»‹è€…ãŒç´¹ä»‹ã‚³ãƒ¼ãƒ‰å–å¾—
   â†“
2. ç´¹ä»‹ãƒªãƒ³ã‚¯ä½œæˆ: /register?ref={ç´¹ä»‹ã‚³ãƒ¼ãƒ‰}
   â†“
3. æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒç´¹ä»‹ãƒªãƒ³ã‚¯çµŒç”±ã§ç™»éŒ²
   â†“
4. Stripeæ±ºæ¸ˆå®Œäº†
   â†“
5. Webhookå‡¦ç†ã§ç´¹ä»‹ãƒ¬ã‚³ãƒ¼ãƒ‰è‡ªå‹•ä½œæˆ
```

### ç´¹ä»‹ã‚¿ã‚¤ãƒ—

ç™»éŒ²æ™‚ç‚¹ã®ãƒ­ãƒ¼ãƒ«ã§è‡ªå‹•åˆ¤å®š:
- **MEMBER**: UGSä¼šå“¡ç´¹ä»‹
- **FP**: FPã‚¨ã‚¤ãƒ‰ç´¹ä»‹

### æ©Ÿèƒ½è©³ç´°

#### ç´¹ä»‹ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ (`/dashboard/referrals`)

è¡¨ç¤ºå†…å®¹:
- è‡ªåˆ†ã®ç´¹ä»‹ã‚³ãƒ¼ãƒ‰
- ç´¹ä»‹ãƒªãƒ³ã‚¯ï¼ˆã‚³ãƒ”ãƒ¼ãƒœã‚¿ãƒ³ä»˜ãï¼‰
- ç´¹ä»‹å®Ÿç¸¾:
  - UGSä¼šå“¡ç´¹ä»‹æ•°
  - FPã‚¨ã‚¤ãƒ‰ç´¹ä»‹æ•°
  - æ‰¿èªå¾…ã¡æ•°
- ç´¹ä»‹ä¸€è¦§ãƒ†ãƒ¼ãƒ–ãƒ«

#### ç´¹ä»‹ç®¡ç†ï¼ˆç®¡ç†è€…ï¼‰ (`/dashboard/admin/referrals`)

æ©Ÿèƒ½:
- å…¨ç´¹ä»‹ãƒ¬ã‚³ãƒ¼ãƒ‰ä¸€è¦§
- æ‰¿èª/å´ä¸‹
- å ±é…¬æ”¯æ‰•ã„ç®¡ç†
- ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ï¼ˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã€ç´¹ä»‹è€…ã€ç´¹ä»‹ã‚¿ã‚¤ãƒ—ï¼‰

### æ˜‡æ ¼æ¡ä»¶ã¨ã®é€£æº

ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼æ˜‡æ ¼æ¡ä»¶:
- **UGSä¼šå“¡ç´¹ä»‹**: 8åä»¥ä¸Š
- **FPã‚¨ã‚¤ãƒ‰ç´¹ä»‹**: 4åä»¥ä¸Š
- **æœŸé–“**: ç›´è¿‘6ãƒ¶æœˆ

è¨ˆç®—æ–¹æ³•:
```typescript
const recentReferrals = await prisma.referral.findMany({
  where: {
    referrerId,
    status: 'APPROVED',
    createdAt: { gte: sixMonthsAgo }
  }
})

const memberCount = recentReferrals.filter(r => r.referralType === 'MEMBER').length
const fpCount = recentReferrals.filter(r => r.referralType === 'FP').length
```

### ç´¹ä»‹å ±é…¬

**æ³¨æ„:** ç¾åœ¨ã€ç´¹ä»‹å ±é…¬æ©Ÿèƒ½ã¯ç„¡åŠ¹åŒ–ã•ã‚Œã¦ã„ã¾ã™ã€‚

å®Ÿè£…ã¯ã•ã‚Œã¦ã„ã¾ã™ãŒã€å ±é…¬è¨ˆç®—æ™‚ã«é™¤å¤–:
```typescript
breakdown: {
  memberReferral: 0,  // ç„¡åŠ¹åŒ–
  fpReferral: 0,      // ç„¡åŠ¹åŒ–
  contract: amount,   // ãƒ¡ã‚¤ãƒ³
  bonus: 0,
  deduction: 0
}
```

### APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

#### ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘
- `GET /api/referrals` - è‡ªåˆ†ã®ç´¹ä»‹ä¸€è¦§
- `GET /api/user/referral-code` - ç´¹ä»‹ã‚³ãƒ¼ãƒ‰å–å¾—
- `GET /api/user/referral-stats` - ç´¹ä»‹çµ±è¨ˆ

#### ç®¡ç†è€…å‘ã‘
- `GET /api/admin/referrals` - å…¨ç´¹ä»‹ä¸€è¦§
- `POST /api/admin/referrals/[referralId]/approve` - æ‰¿èª
- `POST /api/admin/referrals/[referralId]/reject` - å´ä¸‹

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ¢ãƒ‡ãƒ«

```prisma
model Referral {
  id           String         @id
  referrerId   String         // ç´¹ä»‹è€…
  referredId   String         // è¢«ç´¹ä»‹è€…
  referralType ReferralType   // MEMBER/FP
  status       ReferralStatus // PENDING/APPROVED/REJECTED/REWARDED
  rewardAmount Int?
  rewardPaidAt DateTime?
  createdAt    DateTime       @default(now())
}

model User {
  referralCode String? @unique  // 8æ–‡å­—ã®ç´¹ä»‹ã‚³ãƒ¼ãƒ‰
}
```

---

## 9. æ˜‡æ ¼ç”³è«‹æ©Ÿèƒ½

### æ¦‚è¦
2æ®µéšã®æ˜‡æ ¼ã‚·ã‚¹ãƒ†ãƒ ã€‚æ¡ä»¶ã‚’æº€ãŸã™ã¨ç”³è«‹å¯èƒ½ã€‚

### æ˜‡æ ¼ãƒ«ãƒ¼ãƒˆ

```
MEMBERï¼ˆUGSä¼šå“¡ï¼‰
  â†“ LPé¢è«‡ãƒ»åŸºç¤ãƒ†ã‚¹ãƒˆãƒ»ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆ
FPï¼ˆFPã‚¨ã‚¤ãƒ‰ï¼‰
  â†“ å ±é…¬ãƒ»ç´¹ä»‹ãƒ»å¥‘ç´„å®Ÿç¸¾
MANAGERï¼ˆãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ï¼‰
```

### ä¼šå“¡ â†’ FPã‚¨ã‚¤ãƒ‰æ˜‡æ ¼

#### ç”³è«‹å‰æ¡ä»¶ï¼ˆã™ã¹ã¦å¿…é ˆï¼‰

1. **LPé¢è«‡å®Œäº†**
   - `/dashboard/lp-meeting/request` ã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
   - FPã¨ã®é¢è«‡ã‚’å®Ÿæ–½
   - å®Œäº†ã™ã‚‹ã¨ `lpMeetingCompleted: true`

2. **åŸºç¤ãƒ†ã‚¹ãƒˆåˆæ ¼**
   - `/dashboard/basic-test` ã§å—é¨“
   - åˆæ ¼ç‚¹: 80%ä»¥ä¸Šï¼ˆè¨­å®šå¯èƒ½ï¼‰
   - åˆæ ¼ã™ã‚‹ã¨ `basicTestCompleted: true`

3. **ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆæå‡º**
   - `/dashboard/survey` ã§å›ç­”
   - æå‡ºã™ã‚‹ã¨ `surveyCompleted: true`

#### ç”³è«‹ãƒ•ãƒ­ãƒ¼

æ¡ä»¶ã‚’æº€ãŸã™ã¨ `/dashboard/promotion` ã«ã€ŒFPæ˜‡æ ¼ç”³è«‹ã€ãƒœã‚¿ãƒ³ãŒè¡¨ç¤º:

1. **ãƒ¯ãƒ³ã‚¯ãƒªãƒƒã‚¯ç”³è«‹**
   - `status: FP_REVIEW`
   - ç®¡ç†è€…ã«é€šçŸ¥

2. **ç®¡ç†è€…æ‰¿èª**
   - `/dashboard/admin/promotions/fp` ã§ç¢ºèª
   - æ‰¿èª or å´ä¸‹ï¼ˆç†ç”±å…¥åŠ›ï¼‰

3. **æ‰¿èªå¾Œã®æ‰‹ç¶šãï¼ˆã™ã¹ã¦å¿…é ˆï¼‰**
   - æ¥­å‹™å§”è¨—å¥‘ç´„æ›¸ã¸ã®åŒæ„
   - èº«åˆ†è¨¼ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
   - **ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ãƒ†ã‚¹ãƒˆåˆæ ¼**ï¼ˆ90%ä»¥ä¸Šï¼‰â† NEW
   - FPã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°å‹•ç”»è¦–è´ï¼ˆ90%ä»¥ä¸Šï¼‰

4. **ãƒ­ãƒ¼ãƒ«å¤‰æ›´**
   - ã™ã¹ã¦å®Œäº†ã§ `role: FP` ã«æ˜‡æ ¼
   - FPã‚¨ã‚¤ãƒ‰æ©Ÿèƒ½ãŒè§£æ”¾

#### ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ

FPã‚¨ã‚¤ãƒ‰æ˜‡æ ¼ã«å¿…é ˆã®ãƒ†ã‚¹ãƒˆï¼ˆè©³ç´°ã¯[13. ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ](#13-ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ)ã‚’å‚ç…§ï¼‰:
- åˆæ ¼ãƒ©ã‚¤ãƒ³: 90%ä»¥ä¸Š
- ä½•åº¦ã§ã‚‚å†å—é¨“å¯èƒ½
- ä¸åˆæ ¼æ™‚ã¯è§£èª¬è¡¨ç¤º
- åˆæ ¼å¾Œã«ã‚¬ã‚¤ãƒ€ãƒ³ã‚¹å‹•ç”»è¦–è´å¯èƒ½

#### FPã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°

å°‚ç”¨ãƒšãƒ¼ã‚¸ (`/dashboard/fp-onboarding`):
- å‹•ç”»ã‚¬ã‚¤ãƒ€ãƒ³ã‚¹ï¼ˆVimeoï¼‰
- è¦–è´é€²æ—è¿½è·¡
- 90%ä»¥ä¸Šè¦–è´ã§å®Œäº†
- å®Œäº†ã™ã‚‹ã¨ FPã‚¨ã‚¤ãƒ‰ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½
- **ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ãƒ†ã‚¹ãƒˆåˆæ ¼ãŒå‰ææ¡ä»¶**

### FPã‚¨ã‚¤ãƒ‰ â†’ ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼æ˜‡æ ¼

#### æ˜‡æ ¼æ¡ä»¶ï¼ˆã™ã¹ã¦å¿…é ˆï¼‰

è‡ªå‹•åˆ¤å®šã•ã‚Œã‚‹3ã¤ã®æ¡ä»¶:

1. **å ±é…¬å®Ÿç¸¾**
   - ç›´è¿‘6ãƒ¶æœˆå¹³å‡: 70,000å††ä»¥ä¸Š
   - PAID ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®å ±é…¬ã®ã¿ã‚«ã‚¦ãƒ³ãƒˆ

2. **ç´¹ä»‹å®Ÿç¸¾**
   - UGSä¼šå“¡ç´¹ä»‹: 8åä»¥ä¸Š
   - FPã‚¨ã‚¤ãƒ‰ç´¹ä»‹: 4åä»¥ä¸Š
   - APPROVED ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã®ã¿ã‚«ã‚¦ãƒ³ãƒˆ
   - ç›´è¿‘6ãƒ¶æœˆ

3. **å¥‘ç´„å®Ÿç¸¾**
   - ç›´20è¢«ä¿é”æˆ
   - ï¼ˆè©³ç´°ãªè¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ã¯å®Ÿè£…æ¸ˆã¿ï¼‰

#### ç”³è«‹ãƒ•ãƒ­ãƒ¼

æ¡ä»¶ã‚’æº€ãŸã™ã¨è‡ªå‹•çš„ã«ç”³è«‹å¯èƒ½:

1. **ç”³è«‹**
   - `/dashboard/promotion` ã§ã€Œãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼æ˜‡æ ¼ç”³è«‹ã€
   - `status: PENDING`

2. **ç®¡ç†è€…æ‰¿èª**
   - `/dashboard/admin/promotions/manager` ã§ç¢ºèª
   - æ‰¿èª or å´ä¸‹ï¼ˆç†ç”±å…¥åŠ›ï¼‰

3. **ãƒ­ãƒ¼ãƒ«å¤‰æ›´**
   - æ‰¿èªã•ã‚Œã‚‹ã¨ `role: MANAGER` ã«æ˜‡æ ¼
   - ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼æ©Ÿèƒ½ãŒè§£æ”¾

### ç”³è«‹å±¥æ­´

`/dashboard/promotion` ã§ç¢ºèªå¯èƒ½:
- ç”³è«‹æ—¥æ™‚
- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼ˆå¯©æŸ»ä¸­/æ‰¿èª/å´ä¸‹ï¼‰
- å´ä¸‹ç†ç”±ï¼ˆè©²å½“ã™ã‚‹å ´åˆï¼‰

### APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

#### ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘
- `GET /api/promotions/eligibility` - æ˜‡æ ¼æ¡ä»¶ãƒã‚§ãƒƒã‚¯
- `POST /api/promotions/apply` - æ˜‡æ ¼ç”³è«‹
- `GET /api/promotions/history` - ç”³è«‹å±¥æ­´
- `GET /api/user/fp-promotion-status` - FPæ˜‡æ ¼ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
- `POST /api/user/fp-promotion-apply` - FPæ˜‡æ ¼ç”³è«‹
- `POST /api/user/fp-onboarding/complete` - ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°å®Œäº†

#### ç®¡ç†è€…å‘ã‘
- `GET /api/admin/promotions/fp` - FPæ˜‡æ ¼ç”³è«‹ä¸€è¦§
- `POST /api/admin/promotions/fp/[applicationId]/approve` - FPæ˜‡æ ¼æ‰¿èª
- `POST /api/admin/promotions/fp/[applicationId]/reject` - FPæ˜‡æ ¼å´ä¸‹
- `GET /api/admin/promotions/manager` - ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼æ˜‡æ ¼ç”³è«‹ä¸€è¦§
- `POST /api/admin/promotions/manager/[applicationId]/approve` - ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼æ˜‡æ ¼æ‰¿èª
- `POST /api/admin/promotions/manager/[applicationId]/reject` - ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼æ˜‡æ ¼å´ä¸‹

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ¢ãƒ‡ãƒ«

```prisma
model FPPromotionApplication {
  id                    String                          @id
  userId                String
  status                FPPromotionApplicationStatus
  lpMeetingCompleted    Boolean                         @default(false)
  basicTestCompleted    Boolean                         @default(false)
  surveyCompleted       Boolean                         @default(false)
  idDocumentUrl         String?
  contractAgreed        Boolean                         @default(false)
  promotionEmailSent    Boolean                         @default(false)
  appliedAt             DateTime                        @default(now())
  approvedAt            DateTime?
  rejectedAt            DateTime?
  rejectionReason       String?
}

model PromotionApplication {
  id              String          @id
  userId          String
  targetRole      UserRole
  status          PromotionStatus
  appliedAt       DateTime        @default(now())
  approvedAt      DateTime?
  rejectedAt      DateTime?
  rejectionReason String?
  reviewedBy      String?
  reviewNotes     String?
}

model User {
  fpOnboardingCompleted   Boolean   @default(true)
  fpOnboardingCompletedAt DateTime?
}
```

---

## 10. LPé¢è«‡æ©Ÿèƒ½

### æ¦‚è¦
UGSä¼šå“¡ã¨FPã‚¨ã‚¤ãƒ‰ã®ãƒãƒƒãƒãƒ³ã‚°ãƒ»é¢è«‡äºˆç´„ã‚·ã‚¹ãƒ†ãƒ ã€‚FPæ˜‡æ ¼ã®å¿…é ˆæ¡ä»¶ã€‚

### é¢è«‡ã®ç›®çš„

- UGSä¼šå“¡ãŒ FPã‚¨ã‚¤ãƒ‰æ˜‡æ ¼å‰ã«å®Ÿæ–½
- FPã‚¨ã‚¤ãƒ‰ã¨ã®1å¯¾1é¢è«‡
- æ´»å‹•å†…å®¹ã®èª¬æ˜ã€è³ªç–‘å¿œç­”

### æ©Ÿèƒ½è©³ç´°

#### é¢è«‡ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼ˆä¼šå“¡å´ï¼‰ (`/dashboard/lp-meeting/request`)

å…¥åŠ›å†…å®¹:
- **å¸Œæœ›æ—¥æ™‚**: 5ã¤ã¾ã§é¸æŠå¯èƒ½
- **é¢è«‡å ´æ‰€**:
  - ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ï¼ˆZoom/Google Meet/Teamsï¼‰
  - ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ï¼ˆUGSæœ¬ç¤¾ï¼‰
- **ãƒ¡ãƒ¢**: è³ªå•äº‹é …ãªã©

åˆ¶ç´„:
- 1ä¼šå“¡ã«ã¤ã1é¢è«‡ã®ã¿ãƒªã‚¯ã‚¨ã‚¹ãƒˆå¯èƒ½
- æ—¢ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ¸ˆã¿ã®å ´åˆã¯å†ãƒªã‚¯ã‚¨ã‚¹ãƒˆä¸å¯

#### é¢è«‡ç®¡ç†ï¼ˆFPå´ï¼‰ (`/dashboard/lp-meeting/manage`)

è¡¨ç¤ºå†…å®¹:
- è‡ªåˆ†ã«å‰²ã‚Šå½“ã¦ã‚‰ã‚ŒãŸé¢è«‡ä¸€è¦§
- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼ˆREQUESTED/SCHEDULED/COMPLETEDï¼‰
- ä¼šå“¡æƒ…å ±
- å¸Œæœ›æ—¥æ™‚
- ãƒ¡ãƒ¢

æ©Ÿèƒ½:
- æ—¥ç¨‹èª¿æ•´
- é¢è«‡URLè¨­å®šï¼ˆã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã®å ´åˆï¼‰
- é¢è«‡å®Œäº†å ±å‘Š

#### é¢è«‡ç®¡ç†ï¼ˆç®¡ç†è€…ï¼‰ (`/dashboard/admin/lp-meetings`)

æ©Ÿèƒ½:
- å…¨é¢è«‡ãƒªã‚¯ã‚¨ã‚¹ãƒˆä¸€è¦§
- FPã¸ã®ã‚¢ã‚µã‚¤ãƒ³
- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç®¡ç†
- å®Œäº†ç¢ºèª

### é¢è«‡ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹

```
REQUESTED    ãƒªã‚¯ã‚¨ã‚¹ãƒˆå—ä»˜
  â†“ ç®¡ç†è€…ãŒFPã‚¢ã‚µã‚¤ãƒ³
SCHEDULED    ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ç¢ºå®š
  â†“ é¢è«‡å®Ÿæ–½
COMPLETED    é¢è«‡å®Œäº†
CANCELLED    ã‚­ãƒ£ãƒ³ã‚»ãƒ«
NO_SHOW      ãƒãƒ¼ã‚·ãƒ§ãƒ¼ï¼ˆç„¡æ–­æ¬ å¸­ï¼‰â† NEW
```

### å†ç”³è«‹æ©Ÿèƒ½

**é‡è¦ãªå¤‰æ›´:** ä»¥å‰ã¯1ä¼šå“¡ã«ã¤ã1é¢è«‡ã®ã¿ã§ã—ãŸãŒã€ç¾åœ¨ã¯ä»¥ä¸‹ã®æ¡ä»¶ã§å†ç”³è«‹å¯èƒ½:

- **å†ç”³è«‹å¯èƒ½ãªã‚±ãƒ¼ã‚¹:**
  - é¢è«‡å®Œäº†ï¼ˆCOMPLETEDï¼‰å¾Œã«å†åº¦ç”³è«‹
  - ã‚­ãƒ£ãƒ³ã‚»ãƒ«ï¼ˆCANCELLEDï¼‰ã•ã‚ŒãŸå ´åˆ
  - ãƒãƒ¼ã‚·ãƒ§ãƒ¼ï¼ˆNO_SHOWï¼‰ã«ãªã£ãŸå ´åˆ

- **å†ç”³è«‹ä¸å¯ãªã‚±ãƒ¼ã‚¹:**
  - æ—¢ã«ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªé¢è«‡ï¼ˆREQUESTED ã¾ãŸã¯ SCHEDULEDï¼‰ãŒã‚ã‚‹å ´åˆ

ã“ã‚Œã«ã‚ˆã‚Šã€MEMBERã‹ã‚‰FPã¸ã®æ˜‡æ ¼å¾Œã«é™æ ¼ã•ã‚ŒãŸå ´åˆã§ã‚‚ã€å†åº¦LPé¢è«‡ã‚’å—ã‘ã‚‹ã“ã¨ãŒå¯èƒ½ã«ãªã‚Šã¾ã—ãŸã€‚

### æ˜‡æ ¼æ¡ä»¶ã¨ã®é€£æº

é¢è«‡å®Œäº†ã™ã‚‹ã¨:
- `lpMeetingCompleted: true`
- FPæ˜‡æ ¼ç”³è«‹æ¡ä»¶ã®1ã¤ã‚’æº€ãŸã™

### APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

#### ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘
- `POST /api/lp-meetings/request` - é¢è«‡ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
- `GET /api/lp-meetings/my-scheduled` - è‡ªåˆ†ã®äºˆå®š
- `POST /api/lp-meetings/[meetingId]/complete` - é¢è«‡å®Œäº†

#### ç®¡ç†è€…å‘ã‘
- `GET /api/admin/lp-meetings` - é¢è«‡ä¸€è¦§
- `POST /api/admin/lp-meetings/[meetingId]/schedule` - ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«è¨­å®š

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ¢ãƒ‡ãƒ«

```prisma
model LPMeeting {
  id              String           @id
  memberId        String           // è¤‡æ•°é¢è«‡å¯èƒ½ã«å¤‰æ›´ï¼ˆuniqueã‚’å‰Šé™¤ï¼‰
  fpId            String?
  counselorName   String?          // FPä»¥å¤–ã®æ‹…å½“è€…åï¼ˆæ‰‹å‹•å…¥åŠ›ï¼‰â† NEW
  status          LPMeetingStatus  // REQUESTED/SCHEDULED/COMPLETED/CANCELLED/NO_SHOW
  preferredDates  Json             // å¸Œæœ›æ—¥æ™‚5ã¤
  meetingLocation MeetingLocation  // OFFLINE/UGS_OFFICE
  scheduledAt     DateTime?
  completedAt     DateTime?
  cancelledAt     DateTime?        // ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ—¥æ™‚â† NEW
  meetingUrl      String?
  meetingPlatform MeetingPlatform? // ZOOM/GOOGLE_MEET/TEAMS
  notes           String?
  memberNotes     String?
  assignedBy      String?
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt

  // äº‹å‰ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆé–¢é€£
  preInterviewResponses PreInterviewResponse[]
}
```

**é‡è¦ãªå¤‰æ›´ç‚¹:**
- `memberId` ã® `@unique` åˆ¶ç´„ã‚’å‰Šé™¤ â†’ å†ç”³è«‹å¯èƒ½ã«
- `NO_SHOW` ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’è¿½åŠ 
- `counselorName` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¿½åŠ ï¼ˆFPä»¥å¤–ã®æ‹…å½“è€…å¯¾å¿œï¼‰
- `cancelledAt` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¿½åŠ 
- `preInterviewResponses` ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ 

---

## 11. å¥‘ç´„ç®¡ç†æ©Ÿèƒ½

### æ¦‚è¦
å¥‘ç´„å®Ÿç¸¾ã®è¨˜éŒ²ãƒ»ç®¡ç†ã€‚å ±é…¬è¨ˆç®—ã¨æ˜‡æ ¼æ¡ä»¶ã«ä½¿ç”¨ã€‚

### æ©Ÿèƒ½è©³ç´°

#### å¥‘ç´„ç™»éŒ²ï¼ˆç®¡ç†è€…ï¼‰

æ–¹æ³•:
- **CSVä¸€æ‹¬ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰** (æ¨å¥¨)
- å€‹åˆ¥ç™»éŒ²

CSVãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ:
```csv
ãƒ¦ãƒ¼ã‚¶ãƒ¼ID,å¥‘ç´„ç•ªå·,å•†å“å,å¥‘ç´„æ—¥,é‡‘é¡
```

#### å¥‘ç´„ä¸€è¦§ (`/dashboard/contracts`)

è¡¨ç¤ºå†…å®¹:
- å¥‘ç´„ç•ªå·
- å•†å“å
- å¥‘ç´„æ—¥
- é‡‘é¡
- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼ˆACTIVE/CANCELLED/EXPIREDï¼‰

### æ˜‡æ ¼æ¡ä»¶ã¨ã®é€£æº

ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼æ˜‡æ ¼æ¡ä»¶:
- **ç›´20è¢«ä¿é”æˆ**

è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯:
- ç›´è¿‘ã®å¥‘ç´„å®Ÿç¸¾ã‹ã‚‰åˆ¤å®š
- ï¼ˆè©³ç´°ãªãƒ­ã‚¸ãƒƒã‚¯ã¯å®Ÿè£…æ¸ˆã¿ï¼‰

### APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

#### ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘
- `GET /api/contracts` - å¥‘ç´„ä¸€è¦§
- `GET /api/contracts/[contractId]` - å¥‘ç´„è©³ç´°

#### ç®¡ç†è€…å‘ã‘
- `POST /api/admin/contracts/upload/preview` - CSVãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
- `POST /api/admin/contracts/upload/confirm` - CSVç¢ºå®š

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ¢ãƒ‡ãƒ«

```prisma
model Contract {
  id             String         @id
  userId         String
  contractNumber String         @unique
  productName    String?
  contractType   ContractType   // INSURANCE/OTHER
  status         ContractStatus
  signedAt       DateTime
  amount         Int?
  rewardAmount   Int?
  createdAt      DateTime       @default(now())
}
```

---

## 12. åŸºç¤ãƒ†ã‚¹ãƒˆãƒ»ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆ

### æ¦‚è¦
FPæ˜‡æ ¼ã®å¿…é ˆæ¡ä»¶ã€‚ç®¡ç†è€…ãŒä½œæˆãƒ»ç®¡ç†ã€‚

### åŸºç¤ãƒ†ã‚¹ãƒˆ

#### ãƒ†ã‚¹ãƒˆå—é¨“ (`/dashboard/basic-test`)

æ©Ÿèƒ½:
- å•é¡Œè¡¨ç¤ºï¼ˆé¸æŠå¼ãƒ»è¨˜è¿°å¼ï¼‰
- å›ç­”é€ä¿¡
- å³åº§ã«æ¡ç‚¹
- åˆæ ¼/ä¸åˆæ ¼åˆ¤å®š
- çµæœè¡¨ç¤º

åˆæ ¼æ¡ä»¶:
- 80%ä»¥ä¸Šï¼ˆç®¡ç†è€…ãŒè¨­å®šå¯èƒ½ï¼‰

#### ãƒ†ã‚¹ãƒˆç®¡ç†ï¼ˆç®¡ç†è€…ï¼‰ (`/dashboard/admin/basic-test`)

æ©Ÿèƒ½:
- ãƒ†ã‚¹ãƒˆä½œæˆ
- å•é¡Œè¿½åŠ ãƒ»ç·¨é›†
- åˆæ ¼ç‚¹è¨­å®š
- å—é¨“çµæœä¸€è¦§

### ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆ

#### ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆå›ç­” (`/dashboard/survey`)

æ©Ÿèƒ½:
- è³ªå•è¡¨ç¤º
- å›ç­”å…¥åŠ›ï¼ˆé¸æŠå¼ãƒ»è¨˜è¿°å¼ï¼‰
- é€ä¿¡

#### ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆç®¡ç†ï¼ˆç®¡ç†è€…ï¼‰ (`/dashboard/admin/survey`)

æ©Ÿèƒ½:
- ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆä½œæˆ
- è³ªå•è¿½åŠ ãƒ»ç·¨é›†
- å›ç­”çµæœä¸€è¦§
- CSV ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ

### æ˜‡æ ¼æ¡ä»¶ã¨ã®é€£æº

å®Œäº†ã™ã‚‹ã¨:
- åŸºç¤ãƒ†ã‚¹ãƒˆ: `basicTestCompleted: true`
- ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆ: `surveyCompleted: true`

### APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

- `GET /api/basic-test` - ãƒ†ã‚¹ãƒˆå–å¾—
- `POST /api/basic-test` - å›ç­”é€ä¿¡
- `GET /api/survey` - ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆå–å¾—
- `POST /api/survey` - å›ç­”é€ä¿¡
- `GET /api/admin/basic-test` - ãƒ†ã‚¹ãƒˆç®¡ç†
- `GET /api/admin/survey` - ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆç®¡ç†

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ¢ãƒ‡ãƒ«

```prisma
model BasicTest {
  id           String   @id
  title        String
  questions    Json
  passingScore Int      @default(80)
  createdAt    DateTime @default(now())
}

model BasicTestResult {
  id          String   @id
  userId      String
  testId      String
  score       Int
  answers     Json
  isPassed    Boolean
  completedAt DateTime @default(now())
}

model Survey {
  id          String   @id
  title       String
  questions   Json
  createdAt   DateTime @default(now())
}

model SurveySubmission {
  id          String   @id
  userId      String
  surveyId    String
  answers     Json
  submittedAt DateTime @default(now())
}
```

---

## 13. ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ãƒ†ã‚¹ãƒˆ

### æ¦‚è¦
FPã‚¨ã‚¤ãƒ‰å‘ã‘ã®ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹çŸ¥è­˜ã‚’ç¢ºèªã™ã‚‹ãƒ†ã‚¹ãƒˆã€‚FPã‚¨ã‚¤ãƒ‰æ˜‡æ ¼å¾Œã€ã‚¬ã‚¤ãƒ€ãƒ³ã‚¹å‹•ç”»è¦–è´å‰ã«åˆæ ¼ãŒå¿…è¦ã€‚

### å¯¾è±¡ãƒ¦ãƒ¼ã‚¶ãƒ¼
- **FPã‚¨ã‚¤ãƒ‰ï¼ˆFPãƒ­ãƒ¼ãƒ«ï¼‰ã®ã¿**
- MEMBERãŒã‚¢ã‚¯ã‚»ã‚¹ã—ãŸå ´åˆã¯ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ

### ãƒ†ã‚¹ãƒˆä»•æ§˜

#### åˆæ ¼æ¡ä»¶
- **åˆæ ¼ãƒ©ã‚¤ãƒ³: 90%ä»¥ä¸Š**
- å†å—é¨“: ä½•åº¦ã§ã‚‚å¯èƒ½
- ä¸åˆæ ¼æ™‚: é–“é•ãˆãŸå•é¡Œã®è§£èª¬ã‚’è¡¨ç¤º

#### å•é¡Œå½¢å¼
- é¸æŠå¼ï¼ˆè¤‡æ•°é¸æŠè‚¢ï¼‰
- ã‚«ãƒ†ã‚´ãƒªãƒ¼åˆ†é¡å¯èƒ½
- ç®¡ç†è€…ãŒå•é¡Œã‚’è¨­å®šãƒ»ç·¨é›†

### æ©Ÿèƒ½è©³ç´°

#### ãƒ†ã‚¹ãƒˆå—é¨“ (`/dashboard/compliance-test`)

**è¡¨ç¤ºã‚¹ãƒ†ãƒƒãƒ—:**

1. **ã‚¤ãƒ³ãƒˆãƒ­ç”»é¢**
   - ãƒ†ã‚¹ãƒˆæ¦‚è¦è¡¨ç¤º
   - å•é¡Œæ•°è¡¨ç¤º
   - åˆæ ¼ãƒ©ã‚¤ãƒ³è¡¨ç¤ºï¼ˆ90%ï¼‰
   - éå»ã®å—é¨“å±¥æ­´ï¼ˆæœ€æ–°5ä»¶ï¼‰
   - ã€Œãƒ†ã‚¹ãƒˆã‚’é–‹å§‹ã™ã‚‹ã€ãƒœã‚¿ãƒ³

2. **ãƒ†ã‚¹ãƒˆç”»é¢**
   - 1å•ãšã¤è¡¨ç¤º
   - é€²æ—ãƒãƒ¼è¡¨ç¤º
   - å•é¡Œç•ªå·ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆã‚¯ãƒªãƒƒã‚¯ã§ç§»å‹•å¯èƒ½ï¼‰
   - å›ç­”æ¸ˆã¿å•é¡Œã¯ãƒã‚¤ãƒ©ã‚¤ãƒˆè¡¨ç¤º
   - ã€Œå‰ã®å•é¡Œã€ã€Œæ¬¡ã®å•é¡Œã€ãƒœã‚¿ãƒ³

3. **çµæœç”»é¢**
   - åˆæ ¼/ä¸åˆæ ¼è¡¨ç¤º
   - ã‚¹ã‚³ã‚¢è¡¨ç¤ºï¼ˆ%ã¨æ­£è§£æ•°/ç·å•é¡Œæ•°ï¼‰
   - å•é¡Œåˆ¥çµæœ
     - æ­£è§£: ç·‘è‰²ãƒã‚¤ãƒ©ã‚¤ãƒˆ
     - ä¸æ­£è§£: èµ¤è‰²ãƒã‚¤ãƒ©ã‚¤ãƒˆã€è§£èª¬è¡¨ç¤º
   - åˆæ ¼æ™‚: ã€Œã‚¬ã‚¤ãƒ€ãƒ³ã‚¹å‹•ç”»ã¸é€²ã‚€ã€ãƒœã‚¿ãƒ³
   - ä¸åˆæ ¼æ™‚: ã€Œã‚‚ã†ä¸€åº¦å—é¨“ã™ã‚‹ã€ãƒœã‚¿ãƒ³

#### ç®¡ç†è€…ç”»é¢ (`/dashboard/admin/compliance-test`)

**å•é¡Œç®¡ç†:**
- å•é¡Œä¸€è¦§è¡¨ç¤º
- æ–°è¦å•é¡Œä½œæˆ
- å•é¡Œç·¨é›†
- å•é¡Œå‰Šé™¤
- ä¸¦ã³é †å¤‰æ›´ï¼ˆãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ï¼‰
- ã‚«ãƒ†ã‚´ãƒªãƒ¼è¨­å®š

**å—é¨“å±¥æ­´:**
- å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å—é¨“å±¥æ­´
- ã‚¹ã‚³ã‚¢ãƒ»åˆå¦ãƒ»å—é¨“æ—¥æ™‚

### ãƒ­ãƒ¼ãƒ«å¤‰æ›´ã¨ã®é€£æº

**é‡è¦:** FPã‚¨ã‚¤ãƒ‰ãŒMEMBERã«é™æ ¼ã•ã‚ŒãŸå ´åˆ:
- `complianceTestPassed: false` ã«ãƒªã‚»ãƒƒãƒˆ
- `fpOnboardingCompleted: false` ã«ãƒªã‚»ãƒƒãƒˆ
- å†åº¦FPã‚¨ã‚¤ãƒ‰ã«æ˜‡æ ¼æ™‚ã¯ã€å†å—é¨“ãŒå¿…è¦

### APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

#### ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘
- `GET /api/user/compliance-test` - ãƒ†ã‚¹ãƒˆå•é¡Œã¨åˆæ ¼çŠ¶æ³å–å¾—
- `POST /api/user/compliance-test` - å›ç­”æå‡º

#### ç®¡ç†è€…å‘ã‘
- `GET /api/admin/compliance-test/questions` - å•é¡Œä¸€è¦§
- `POST /api/admin/compliance-test/questions` - å•é¡Œä½œæˆ
- `PUT /api/admin/compliance-test/questions/[id]` - å•é¡Œæ›´æ–°
- `DELETE /api/admin/compliance-test/questions/[id]` - å•é¡Œå‰Šé™¤
- `POST /api/admin/compliance-test/questions/reorder` - ä¸¦ã³é †å¤‰æ›´
- `GET /api/admin/compliance-test/attempts` - å—é¨“å±¥æ­´ä¸€è¦§

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ¢ãƒ‡ãƒ«

```prisma
model ComplianceTestQuestion {
  id           String   @id @default(cuid())
  question     String   @db.Text
  options      Json     // é¸æŠè‚¢é…åˆ—
  correctIndex Int      // æ­£è§£ã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹
  explanation  String?  @db.Text  // è§£èª¬ï¼ˆä¸æ­£è§£æ™‚ã«è¡¨ç¤ºï¼‰
  category     String?  // ã‚«ãƒ†ã‚´ãƒªãƒ¼
  order        Int      @default(0)
  isActive     Boolean  @default(true)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  attempts     ComplianceTestAnswer[]
}

model ComplianceTestAttempt {
  id             String   @id @default(cuid())
  userId         String
  totalQuestions Int
  correctCount   Int
  score          Float    // ãƒ‘ãƒ¼ã‚»ãƒ³ãƒ†ãƒ¼ã‚¸
  isPassed       Boolean
  createdAt      DateTime @default(now())

  user    User                     @relation(fields: [userId], references: [id])
  answers ComplianceTestAnswer[]
}

model ComplianceTestAnswer {
  id              String   @id @default(cuid())
  attemptId       String
  questionId      String
  selectedAnswer  Int
  isCorrect       Boolean
  createdAt       DateTime @default(now())

  attempt  ComplianceTestAttempt    @relation(fields: [attemptId], references: [id])
  question ComplianceTestQuestion   @relation(fields: [questionId], references: [id])

  @@unique([attemptId, questionId])
}

model User {
  complianceTestPassed    Boolean   @default(false)
  complianceTestPassedAt  DateTime?
  // ...
}
```

---

## 14. äº‹å‰ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆæ©Ÿèƒ½

### æ¦‚è¦
LPé¢è«‡ã®å‰ã«ãƒ¡ãƒ³ãƒãƒ¼ãŒå›ç­”ã™ã‚‹äº‹å‰ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆã€‚ç®¡ç†è€…ãŒãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½œæˆã—ã€é¢è«‡äºˆç´„æ™‚ã«è‡ªå‹•çš„ã«å›ç­”ä¾é ¼ãŒé€ã‚‰ã‚Œã‚‹ã€‚

### å¯¾è±¡ãƒ¦ãƒ¼ã‚¶ãƒ¼
- **LPé¢è«‡ã‚’äºˆç´„ã—ãŸMEMBER**
- FPã¯é¢è«‡ç®¡ç†ç”»é¢ã§å›ç­”ã‚’ç¢ºèªå¯èƒ½

### æ©Ÿèƒ½è©³ç´°

#### ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆå›ç­” (`/dashboard/pre-interview`)

**å›ç­”ãƒ•ãƒ­ãƒ¼:**
1. LPé¢è«‡äºˆç´„æ™‚ã«ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆãŒè‡ªå‹•ä½œæˆ
2. ãƒ¡ãƒ³ãƒãƒ¼ãŒã‚¢ãƒ³ã‚±ãƒ¼ãƒˆãƒšãƒ¼ã‚¸ã«ã‚¢ã‚¯ã‚»ã‚¹
3. è³ªå•ã«å›ç­”ï¼ˆé€”ä¸­ä¿å­˜å¯èƒ½ï¼‰
4. å…¨å¿…é ˆé …ç›®å›ç­”å¾Œã«ã€Œé€ä¿¡ã€
5. FPã«é€šçŸ¥

**å›ç­”ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:**
```
NOT_STARTED  æœªé–‹å§‹
IN_PROGRESS  å›ç­”ä¸­ï¼ˆé€”ä¸­ä¿å­˜æ¸ˆã¿ï¼‰
COMPLETED    å›ç­”å®Œäº†
```

#### è³ªå•ã‚¿ã‚¤ãƒ—
- **TEXT**: ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›
- **TEXTAREA**: é•·æ–‡ãƒ†ã‚­ã‚¹ãƒˆ
- **RADIO**: ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³ï¼ˆå˜ä¸€é¸æŠï¼‰
- **CHECKBOX**: ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ï¼ˆè¤‡æ•°é¸æŠï¼‰
- **SELECT**: ãƒ—ãƒ«ãƒ€ã‚¦ãƒ³é¸æŠ

#### ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç®¡ç† (`/dashboard/admin/pre-interview-templates`)

**ç®¡ç†è€…æ©Ÿèƒ½:**
- ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä½œæˆãƒ»ç·¨é›†
- è³ªå•è¿½åŠ ãƒ»å‰Šé™¤
- è³ªå•ã®ä¸¦ã³é †å¤‰æ›´
- å¿…é ˆ/ä»»æ„è¨­å®š
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆè¨­å®š

#### FPå´ã®ç¢ºèª (`/dashboard/lp-meeting/manage`)

é¢è«‡ç®¡ç†ç”»é¢ã§:
- å›ç­”ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç¢ºèª
- å›ç­”å†…å®¹é–²è¦§
- å›ç­”å®Œäº†é€šçŸ¥å—ä¿¡

### é€šçŸ¥é€£æº

**å›ç­”å®Œäº†æ™‚:**
- æ‹…å½“FPã«ã‚¢ãƒ—ãƒªå†…é€šçŸ¥
- é€šçŸ¥ã‚¿ã‚¤ãƒ—: `PRE_INTERVIEW_COMPLETED`

### APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

#### ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘
- `GET /api/pre-interview` - è‡ªåˆ†ã®ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆå›ç­”çŠ¶æ³å–å¾—
- `POST /api/pre-interview` - å›ç­”ä¿å­˜ï¼ˆé€”ä¸­ä¿å­˜ãƒ»å®Œäº†ï¼‰
- `GET /api/pre-interview/[responseId]` - å›ç­”è©³ç´°å–å¾—

#### ç®¡ç†è€…å‘ã‘
- `GET /api/admin/pre-interview-templates` - ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä¸€è¦§
- `POST /api/admin/pre-interview-templates` - ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆä½œæˆ
- `PUT /api/admin/pre-interview-templates/[id]` - ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæ›´æ–°
- `DELETE /api/admin/pre-interview-templates/[id]` - ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆå‰Šé™¤

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ¢ãƒ‡ãƒ«

```prisma
model PreInterviewTemplate {
  id          String   @id @default(cuid())
  name        String
  description String?
  isActive    Boolean  @default(true)
  isDefault   Boolean  @default(false)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  questions   PreInterviewQuestion[]
  responses   PreInterviewResponse[]
}

model PreInterviewQuestion {
  id         String                   @id @default(cuid())
  templateId String
  question   String                   @db.Text
  type       PreInterviewQuestionType // TEXT/TEXTAREA/RADIO/CHECKBOX/SELECT
  options    Json?                    // é¸æŠè‚¢ï¼ˆRADIO/CHECKBOX/SELECTç”¨ï¼‰
  required   Boolean                  @default(false)
  order      Int                      @default(0)
  createdAt  DateTime                 @default(now())
  updatedAt  DateTime                 @updatedAt

  template   PreInterviewTemplate     @relation(fields: [templateId], references: [id])
  answers    PreInterviewAnswer[]
}

model PreInterviewResponse {
  id                    String                      @id @default(cuid())
  templateId            String
  respondentId          String                      // å›ç­”è€…ï¼ˆMEMBERï¼‰
  lpMeetingId           String?                     // é–¢é€£ã™ã‚‹LPé¢è«‡
  status                PreInterviewResponseStatus  // NOT_STARTED/IN_PROGRESS/COMPLETED
  startedAt             DateTime?
  completedAt           DateTime?
  completionNotifiedAt  DateTime?                   // FPã¸ã®é€šçŸ¥é€ä¿¡æ—¥æ™‚
  createdAt             DateTime                    @default(now())
  updatedAt             DateTime                    @updatedAt

  template   PreInterviewTemplate  @relation(fields: [templateId], references: [id])
  respondent User                  @relation(fields: [respondentId], references: [id])
  lpMeeting  LPMeeting?            @relation(fields: [lpMeetingId], references: [id])
  answers    PreInterviewAnswer[]
}

model PreInterviewAnswer {
  id         String   @id @default(cuid())
  responseId String
  questionId String
  value      Json     // å›ç­”å€¤ï¼ˆæ–‡å­—åˆ—ã¾ãŸã¯é…åˆ—ï¼‰
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  response   PreInterviewResponse  @relation(fields: [responseId], references: [id])
  question   PreInterviewQuestion  @relation(fields: [questionId], references: [id])

  @@unique([responseId, questionId])
}
```

---

## 15. å€‹åˆ¥ç›¸è«‡æ©Ÿèƒ½

### æ¦‚è¦
ãƒ¡ãƒ³ãƒãƒ¼ãŒå„ç¨®ç›¸è«‡ï¼ˆãƒ©ã‚¤ãƒ•ãƒ—ãƒ©ãƒ³ã€ä½å®…ã€è»¢è·ãªã©ï¼‰ã‚’ç”³è«‹ã§ãã‚‹æ©Ÿèƒ½ã€‚ç®¡ç†è€…ãŒå¯¾å¿œãƒ»ç®¡ç†ã€‚

### å¯¾è±¡ãƒ¦ãƒ¼ã‚¶ãƒ¼
- **å…¨èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼**

### ç›¸è«‡ã‚¸ãƒ£ãƒ³ãƒ«

| ã‚¸ãƒ£ãƒ³ãƒ« | ã‚³ãƒ¼ãƒ‰ | èª¬æ˜ |
|---------|--------|------|
| ãƒ©ã‚¤ãƒ•ãƒ—ãƒ©ãƒ³ | LIFE_PLAN | å°†æ¥è¨­è¨ˆã€è³‡ç”£å½¢æˆãªã© |
| ä½å®… | HOUSING | ä½å®…ãƒ­ãƒ¼ãƒ³ã€è³¼å…¥ç›¸è«‡ãªã© |
| è»¢è· | CAREER | ã‚­ãƒ£ãƒªã‚¢ç›¸è«‡ã€è»¢è·æ”¯æ´ãªã© |
| è³ƒè²¸ | RENTAL | è³ƒè²¸ç‰©ä»¶ç›¸è«‡ãªã© |
| ãã®ä»– | OTHER | ä¸Šè¨˜ä»¥å¤–ã®ç›¸è«‡ |

### é€£çµ¡æ–¹æ³•

| æ–¹æ³• | ã‚³ãƒ¼ãƒ‰ | èª¬æ˜ |
|------|--------|------|
| é›»è©± | PHONE | é›»è©±ã§ã®é€£çµ¡å¸Œæœ› |
| ãƒ¡ãƒ¼ãƒ« | EMAIL | ãƒ¡ãƒ¼ãƒ«ã§ã®é€£çµ¡å¸Œæœ› |
| LINE | LINE | LINEã§ã®é€£çµ¡å¸Œæœ› |
| ãã®ä»– | OTHER | ãã®ä»–ã®æ–¹æ³• |

### æ©Ÿèƒ½è©³ç´°

#### ç›¸è«‡ç”³è«‹ (`/dashboard/consultation`)

**ç”³è«‹ç”»é¢:**
- ç›¸è«‡ã‚¸ãƒ£ãƒ³ãƒ«é¸æŠ
- é›»è©±ç•ªå·å…¥åŠ›
- ç›¸è«‡å†…å®¹å…¥åŠ›
- å¸Œæœ›é€£çµ¡æ–¹æ³•é¸æŠ
- å¸Œæœ›æ—¥æ™‚é¸æŠï¼ˆè¤‡æ•°å¯ï¼‰
- æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

**ã‚¸ãƒ£ãƒ³ãƒ«åˆ¥ãƒšãƒ¼ã‚¸:**
- `/dashboard/consultation/[type]`
- ä¾‹: `/dashboard/consultation/life-plan`

#### ç›¸è«‡å±¥æ­´ (`/dashboard/consultation/history`)

**è¡¨ç¤ºå†…å®¹:**
- è‡ªåˆ†ã®ç›¸è«‡ä¸€è¦§
- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼ˆæœªå¯¾å¿œ/å¯¾å¿œä¸­/å®Œäº†ï¼‰
- ç›¸è«‡ã‚¸ãƒ£ãƒ³ãƒ«
- ç”³è«‹æ—¥æ™‚
- æ‹…å½“è€…ï¼ˆã‚¢ã‚µã‚¤ãƒ³æ¸ˆã¿ã®å ´åˆï¼‰

#### ç®¡ç†è€…ç”»é¢ (`/dashboard/admin/consultations`)

**ä¸€è¦§è¡¨ç¤º:**
- å…¨ç›¸è«‡ä¸€è¦§
- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆ¥ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
- ã‚¸ãƒ£ãƒ³ãƒ«åˆ¥ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼
- çµ±è¨ˆæƒ…å ±è¡¨ç¤º
  - ç·ä»¶æ•°
  - æœªå¯¾å¿œä»¶æ•°
  - å¯¾å¿œä¸­ä»¶æ•°
  - å®Œäº†ä»¶æ•°
  - ã‚¸ãƒ£ãƒ³ãƒ«åˆ¥ä»¶æ•°

**è©³ç´°ç”»é¢ (`/dashboard/admin/consultations/[id]`):**
- ç›¸è«‡å†…å®¹è©³ç´°
- ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±
- æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«é–²è¦§
- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å¤‰æ›´
- æ‹…å½“è€…ã‚¢ã‚µã‚¤ãƒ³
- ç®¡ç†è€…ãƒ¡ãƒ¢å…¥åŠ›

### ç›¸è«‡ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹

```
PENDING       æœªå¯¾å¿œ
  â†“ ç®¡ç†è€…ãŒå¯¾å¿œé–‹å§‹
IN_PROGRESS   å¯¾å¿œä¸­
  â†“ å¯¾å¿œå®Œäº†
COMPLETED     å®Œäº†
```

### é€šçŸ¥é€£æº

**ç”³è«‹æ™‚:**
- å…¨ç®¡ç†è€…ã«ã‚¢ãƒ—ãƒªå†…é€šçŸ¥
- é€šçŸ¥ã‚¿ã‚¤ãƒ—: `CONSULTATION_SUBMITTED`

### APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

#### ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘
- `POST /api/consultations` - ç›¸è«‡ç”³è«‹
- `GET /api/consultations` - è‡ªåˆ†ã®ç›¸è«‡å±¥æ­´
- `POST /api/consultations/upload` - æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰

#### ç®¡ç†è€…å‘ã‘
- `GET /api/admin/consultations` - ç›¸è«‡ä¸€è¦§
- `GET /api/admin/consultations/[id]` - ç›¸è«‡è©³ç´°
- `PUT /api/admin/consultations/[id]` - ç›¸è«‡æ›´æ–°ï¼ˆã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã€æ‹…å½“è€…ãªã©ï¼‰

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ¢ãƒ‡ãƒ«

```prisma
model Consultation {
  id               String              @id @default(cuid())
  userId           String
  type             ConsultationType    // LIFE_PLAN/HOUSING/CAREER/RENTAL/OTHER
  phoneNumber      String
  content          String              @db.Text
  preferredContact ContactMethod       // PHONE/EMAIL/LINE/OTHER
  preferredDates   DateTime[]          // å¸Œæœ›æ—¥æ™‚ï¼ˆè¤‡æ•°ï¼‰
  attachmentUrl    String?             // æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«URL
  attachmentName   String?             // æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«å
  status           ConsultationStatus  // PENDING/IN_PROGRESS/COMPLETED
  handlerId        String?             // æ‹…å½“è€…ID
  adminNotes       String?             @db.Text  // ç®¡ç†è€…ãƒ¡ãƒ¢
  completedAt      DateTime?
  createdAt        DateTime            @default(now())
  updatedAt        DateTime            @updatedAt

  user    User  @relation("UserConsultations", fields: [userId], references: [id])
  handler User? @relation("ConsultationHandler", fields: [handlerId], references: [id])
}
```

---

## 16. FAQãƒ»ãŠå•ã„åˆã‚ã›

> **æ³¨:** ä»¥å‰ã¯ã€Œ13. FAQãƒ»ãŠå•ã„åˆã‚ã›ã€ã§ã—ãŸãŒã€æ–°æ©Ÿèƒ½è¿½åŠ ã«ã‚ˆã‚Šç•ªå·ãŒå¤‰æ›´ã•ã‚Œã¾ã—ãŸã€‚

### æ¦‚è¦
ã‚ˆãã‚ã‚‹è³ªå•ã¨å€‹åˆ¥å•ã„åˆã‚ã›æ©Ÿèƒ½ã€‚

### FAQ

#### FAQé–²è¦§ (`/dashboard/support/faq`)

æ©Ÿèƒ½:
- ã‚«ãƒ†ã‚´ãƒªãƒ¼åˆ¥è¡¨ç¤º
- ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³å½¢å¼
- æ¤œç´¢æ©Ÿèƒ½

#### FAQç®¡ç†ï¼ˆç®¡ç†è€…ï¼‰ (`/dashboard/admin/faq`)

æ©Ÿèƒ½:
- ã‚«ãƒ†ã‚´ãƒªãƒ¼ä½œæˆãƒ»ç·¨é›†
- FAQè¿½åŠ ãƒ»ç·¨é›†ãƒ»å‰Šé™¤
- ä¸¦ã³é †å¤‰æ›´
- å…¬é–‹/éå…¬é–‹è¨­å®š

### ãŠå•ã„åˆã‚ã›

#### ãŠå•ã„åˆã‚ã›é€ä¿¡ (`/dashboard/support/contact`)

å…¥åŠ›é …ç›®:
- å•ã„åˆã‚ã›ç¨®åˆ¥:
  - ã‚¢ã‚«ã‚¦ãƒ³ãƒˆé–¢é€£
  - æ”¯æ‰•ã„é–¢é€£
  - ã‚³ãƒ³ãƒ†ãƒ³ãƒ„é–¢é€£
  - æŠ€è¡“çš„ãªå•é¡Œ
  - ãã®ä»–
- ä»¶å
- æœ¬æ–‡
- æ·»ä»˜ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

#### ãŠå•ã„åˆã‚ã›ç®¡ç†ï¼ˆç®¡ç†è€…ï¼‰ (`/dashboard/admin/contacts`)

æ©Ÿèƒ½:
- å•ã„åˆã‚ã›ä¸€è¦§
- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç®¡ç†:
  - PENDINGï¼ˆæœªå¯¾å¿œï¼‰
  - IN_PROGRESSï¼ˆå¯¾å¿œä¸­ï¼‰
  - RESOLVEDï¼ˆè§£æ±ºæ¸ˆã¿ï¼‰
  - CLOSEDï¼ˆã‚¯ãƒ­ãƒ¼ã‚ºï¼‰
- ç®¡ç†è€…ãƒ¡ãƒ¢
- å¯¾å¿œè€…è¨˜éŒ²

### APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

- `GET /api/faq` - FAQä¸€è¦§
- `POST /api/contact` - ãŠå•ã„åˆã‚ã›é€ä¿¡
- `GET /api/admin/faq` - FAQç®¡ç†
- `GET /api/admin/contacts` - ãŠå•ã„åˆã‚ã›ç®¡ç†
- `PUT /api/admin/contacts/[contactId]` - ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ¢ãƒ‡ãƒ«

```prisma
model FAQCategory {
  id          String  @id
  name        String
  description String?
  order       Int
  isActive    Boolean @default(true)
}

model FAQ {
  id          String  @id
  categoryId  String
  question    String
  answer      String  @db.Text
  order       Int
  isPublished Boolean @default(true)
}

model ContactSubmission {
  id            String        @id
  userId        String
  name          String
  email         String
  type          ContactType
  subject       String?
  message       String        @db.Text
  attachmentUrl String?
  status        ContactStatus @default(PENDING)
  adminNotes    String?
  respondedBy   String?
  respondedAt   DateTime?
  createdAt     DateTime      @default(now())
}
```

---

## 17. ååˆºæ³¨æ–‡æ©Ÿèƒ½

### æ¦‚è¦
FPã‚¨ã‚¤ãƒ‰ãƒ»ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼å‘ã‘ã®ååˆºæ³¨æ–‡ã‚·ã‚¹ãƒ†ãƒ ã€‚Stripeæ±ºæ¸ˆå¯¾å¿œã€‚

### ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™
- FPã‚¨ã‚¤ãƒ‰ä»¥ä¸Šã®ã¿åˆ©ç”¨å¯èƒ½

### æ©Ÿèƒ½è©³ç´°

#### ååˆºæ³¨æ–‡ (`/dashboard/business-card/order`)

æ‰‹é †:
1. **ãƒ‡ã‚¶ã‚¤ãƒ³é¸æŠ**
   - ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”»åƒã§ç¢ºèª
   - ãƒ‡ã‚¶ã‚¤ãƒ³ã‚’é¸æŠ

2. **å°å­—æƒ…å ±å…¥åŠ›**
   - è¡¨ç¤ºåï¼ˆæ¼¢å­—ï¼‰
   - è¡¨ç¤ºåï¼ˆã‚«ãƒŠï¼‰
   - é›»è©±ç•ªå·
   - ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹

3. **å—å–æ–¹æ³•é¸æŠ**
   - æœ¬ç¤¾æ‰‹æ¸¡ã—
   - éƒµé€ï¼ˆé€æ–™è¾¼ã¿ï¼‰

4. **éƒµé€å…ˆå…¥åŠ›**ï¼ˆéƒµé€ã®å ´åˆï¼‰
   - éƒµä¾¿ç•ªå·
   - éƒ½é“åºœçœŒ
   - å¸‚åŒºç”ºæ‘
   - ç•ªåœ°
   - å»ºç‰©åãƒ»éƒ¨å±‹ç•ªå·

5. **æ•°é‡ãƒ»ãƒ¡ãƒ¢**
   - æ•°é‡ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 100æšï¼‰
   - å‚™è€ƒæ¬„

6. **Stripeæ±ºæ¸ˆ**
   - æ±ºæ¸ˆãƒšãƒ¼ã‚¸ã«é·ç§»
   - ã‚«ãƒ¼ãƒ‰æ±ºæ¸ˆ

7. **æ³¨æ–‡å®Œäº†**

#### æ³¨æ–‡å±¥æ­´ (`/dashboard/business-card/history`)

è¡¨ç¤ºå†…å®¹:
- æ³¨æ–‡æ—¥
- ãƒ‡ã‚¶ã‚¤ãƒ³
- æ•°é‡
- å—å–æ–¹æ³•
- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:
  - PENDINGï¼ˆæ±ºæ¸ˆå¾…ã¡ï¼‰
  - PAIDï¼ˆæ±ºæ¸ˆå®Œäº†ï¼‰
  - ORDEREDï¼ˆç™ºæ³¨æ¸ˆã¿ï¼‰
  - SHIPPEDï¼ˆç™ºé€æ¸ˆã¿ï¼‰
  - COMPLETEDï¼ˆå®Œäº†ï¼‰

#### ååˆºç®¡ç†ï¼ˆç®¡ç†è€…ï¼‰ (`/dashboard/admin/business-card`)

**ãƒ‡ã‚¶ã‚¤ãƒ³ç®¡ç†:**
- ãƒ‡ã‚¶ã‚¤ãƒ³è¿½åŠ 
- ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
- æœ‰åŠ¹/ç„¡åŠ¹è¨­å®š
- ä¸¦ã³é †å¤‰æ›´

**æ³¨æ–‡ç®¡ç†:**
- æ³¨æ–‡ä¸€è¦§
- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°
- ç™ºé€ç®¡ç†
- ç®¡ç†ãƒ¡ãƒ¢

### APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

#### ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘
- `GET /api/business-card/designs` - ãƒ‡ã‚¶ã‚¤ãƒ³ä¸€è¦§
- `POST /api/business-card/checkout` - æ±ºæ¸ˆé–‹å§‹
- `POST /api/business-card/verify-payment` - æ±ºæ¸ˆç¢ºèª
- `GET /api/business-card/orders` - æ³¨æ–‡å±¥æ­´

#### ç®¡ç†è€…å‘ã‘
- `GET /api/admin/business-card/designs` - ãƒ‡ã‚¶ã‚¤ãƒ³ç®¡ç†
- `POST /api/admin/business-card/designs` - ãƒ‡ã‚¶ã‚¤ãƒ³è¿½åŠ 
- `PUT /api/admin/business-card/designs/[designId]` - ãƒ‡ã‚¶ã‚¤ãƒ³æ›´æ–°
- `POST /api/admin/business-card/designs/upload-preview` - ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
- `GET /api/admin/business-card/orders` - æ³¨æ–‡ä¸€è¦§
- `PUT /api/admin/business-card/orders/[orderId]` - æ³¨æ–‡æ›´æ–°

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ¢ãƒ‡ãƒ«

```prisma
model BusinessCardDesign {
  id          String  @id
  name        String
  description String?
  previewUrl  String?
  isActive    Boolean @default(true)
  order       Int     @default(0)
}

model BusinessCardOrder {
  id               String                      @id
  userId           String
  designId         String
  displayName      String
  displayNameKana  String
  phoneNumber      String
  email            String
  deliveryMethod   BusinessCardDeliveryMethod
  postalCode       String?
  prefecture       String?
  city             String?
  addressLine1     String?
  addressLine2     String?
  quantity         Int                         @default(100)
  notes            String?
  paymentStatus    BusinessCardPaymentStatus
  stripeSessionId  String?
  paidAmount       Int?
  paidAt           DateTime?
  status           BusinessCardOrderStatus
  adminNotes       String?
  processedBy      String?
  shippedAt        DateTime?
  completedAt      DateTime?
}
```

---

## 18. ãƒãƒ¼ãƒ ç®¡ç†æ©Ÿèƒ½

### æ¦‚è¦
ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼å‘ã‘ã®ãƒãƒ¼ãƒ ç®¡ç†æ©Ÿèƒ½ã€‚

### æ©Ÿèƒ½è©³ç´°

#### ãƒãƒ¼ãƒ ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ (`/dashboard/team`)

è¡¨ç¤ºå†…å®¹:
- ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ä¸€è¦§
- ãƒ¡ãƒ³ãƒãƒ¼ã®åŸºæœ¬æƒ…å ±
- æ´»å‹•çŠ¶æ³
- ãƒãƒ¼ãƒ çµ±è¨ˆ

#### ãƒãƒ¼ãƒ çµ±è¨ˆ

API: `GET /api/team/stats`

è¡¨ç¤ºãƒ‡ãƒ¼ã‚¿:
- ãƒãƒ¼ãƒ å…¨ä½“ã®å¥‘ç´„æ•°
- æœˆæ¬¡å®Ÿç¸¾
- ãƒ¡ãƒ³ãƒãƒ¼åˆ¥ãƒ©ãƒ³ã‚­ãƒ³ã‚°

### APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

- `GET /api/team/members` - ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ä¸€è¦§
- `GET /api/team/stats` - ãƒãƒ¼ãƒ çµ±è¨ˆ

---

## 19. ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ç®¡ç†

### æ¦‚è¦
æœˆé¡ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã®ç®¡ç†ã€‚Stripeé€£æºã€‚

### æ©Ÿèƒ½è©³ç´°

#### ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³çŠ¶æ³ (`/dashboard/settings/subscription`)

è¡¨ç¤ºå†…å®¹:
- ç¾åœ¨ã®ãƒ—ãƒ©ãƒ³
- æ¬¡å›æ›´æ–°æ—¥
- æ”¯æ‰•ã„æ–¹æ³•
- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹:
  - ACTIVEï¼ˆæœ‰åŠ¹ï¼‰
  - CANCELEDï¼ˆè§£ç´„æ¸ˆã¿ï¼‰
  - PAST_DUEï¼ˆæ”¯æ‰•ã„é…å»¶ï¼‰
  - UNPAIDï¼ˆæœªæ‰•ã„ï¼‰

æ©Ÿèƒ½:
- æ”¯æ‰•ã„æ–¹æ³•å¤‰æ›´
- ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³è§£ç´„
- å†é–‹

### è§£ç´„ãƒ•ãƒ­ãƒ¼

1. **è§£ç´„ç”³è«‹**
   - ç†ç”±é¸æŠ
   - ã‚³ãƒ¡ãƒ³ãƒˆå…¥åŠ›

2. **å³æ™‚è§£ç´„ or æœŸé–“æº€äº†å¾Œè§£ç´„**
   - ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒé¸æŠ

3. **Stripeå‡¦ç†**
   - Webhookå—ä¿¡
   - ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æ›´æ–°

### APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

- `GET /api/subscription/status` - ã‚µãƒ–ã‚¹ã‚¯çŠ¶æ³
- `GET /api/user/subscription` - è©³ç´°æƒ…å ±
- `POST /api/user/subscription/cancel` - è§£ç´„
- `POST /api/user/subscription/reactivate` - å†é–‹
- `POST /api/user/subscription/update-payment-method` - æ”¯æ‰•ã„æ–¹æ³•å¤‰æ›´
- `GET /api/user/subscription/invoices` - è«‹æ±‚æ›¸å±¥æ­´

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ¢ãƒ‡ãƒ«

```prisma
model Subscription {
  id                   String             @id
  userId               String
  stripeCustomerId     String?            @unique
  stripeSubscriptionId String?            @unique
  status               SubscriptionStatus
  currentPeriodEnd     DateTime?
  createdAt            DateTime           @default(now())
  updatedAt            DateTime           @updatedAt
}
```

---

## 20. ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒ»ã‚¢ã‚«ã‚¦ãƒ³ãƒˆè¨­å®š

### æ¦‚è¦
ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®ç®¡ç†ã€‚

### ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«è¨­å®š (`/dashboard/settings/profile`)

ç·¨é›†å¯èƒ½é …ç›®:
- åå‰
- **ä¼šå“¡ç•ªå·**ï¼ˆèª­ã¿å–ã‚Šå°‚ç”¨ï¼‰
- é›»è©±ç•ªå·
- ä½æ‰€
- è‡ªå·±ç´¹ä»‹
- æ€§åˆ¥
- ç”Ÿå¹´æœˆæ—¥
- éƒ½é“åºœçœŒ
- ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒ

### ã‚¢ã‚«ã‚¦ãƒ³ãƒˆè¨­å®š (`/dashboard/settings/account`)

æ©Ÿèƒ½:
- ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´
- ãƒ¡ãƒ¼ãƒ«é€šçŸ¥è¨­å®š
- é€€ä¼šç”³è«‹

### APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

- `PUT /api/user/update-profile` - ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æ›´æ–°
- `POST /api/user/change-password` - ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å¤‰æ›´
- `POST /api/user/upload-profile-image` - ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
- `POST /api/user/cancel-request` - é€€ä¼šç”³è«‹

---

## 21. ç®¡ç†è€…æ©Ÿèƒ½

### æ¦‚è¦
ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã®ç®¡ç†æ©Ÿèƒ½ã€‚

### ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ (`/dashboard/admin`)

è¡¨ç¤ºå†…å®¹:
- ãƒ¦ãƒ¼ã‚¶ãƒ¼çµ±è¨ˆ
- ãƒ­ãƒ¼ãƒ«åˆ¥çµ±è¨ˆ
- æœˆæ¬¡æ¨ç§»ã‚°ãƒ©ãƒ•
- æœ€è¿‘ã®ã‚¢ã‚¯ãƒ†ã‚£ãƒ“ãƒ†ã‚£

### åˆ†ææ©Ÿèƒ½ (`/dashboard/admin/analytics`)

æ©Ÿèƒ½:
- ä¼šå“¡çµ±è¨ˆ (`/api/admin/analytics/membership`)
  - ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹åˆ¥é›†è¨ˆ
  - æœˆæ¬¡æ¨ç§»
  - ãƒ­ãƒ¼ãƒ«åˆ¥åˆ†å¸ƒ

- ãƒ­ãƒ¼ãƒ«åˆ¥çµ±è¨ˆ (`/api/admin/analytics/role-stats`)
  - ãƒ­ãƒ¼ãƒ«ã”ã¨ã®äººæ•°
  - æ˜‡æ ¼ç‡
  - æ´»å‹•çŠ¶æ³

### ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç† (`/dashboard/admin/users`)

æ©Ÿèƒ½:
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§
  - ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ï¼ˆãƒ­ãƒ¼ãƒ«ã€ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã€æ¤œç´¢ï¼‰
  - æ¤œç´¢ï¼ˆåå‰ã€ãƒ¡ãƒ¼ãƒ«ã€**ä¼šå“¡ç•ªå·**ï¼‰
  - ã‚½ãƒ¼ãƒˆ
- ãƒ¦ãƒ¼ã‚¶ãƒ¼è©³ç´°
- ãƒ­ãƒ¼ãƒ«å¤‰æ›´
- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å¤‰æ›´
- ä¸€æ‹¬ãƒ¡ãƒ¼ãƒ«é€ä¿¡
- ä¸€æ‹¬ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å¤‰æ›´
- CSV ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ

### ãƒ¡ãƒ¼ãƒ«é€ä¿¡å±¥æ­´ (`/dashboard/admin/email-history`)

æ©Ÿèƒ½:
- ã‚­ãƒ£ãƒ³ãƒšãƒ¼ãƒ³ä¸€è¦§
- é…ä¿¡çŠ¶æ³ï¼ˆæˆåŠŸ/å¤±æ•—ï¼‰
- å€‹åˆ¥é…ä¿¡ãƒ­ã‚°
- å†é€æ©Ÿèƒ½

### ãã®ä»–ç®¡ç†æ©Ÿèƒ½

- ã‚¤ãƒ™ãƒ³ãƒˆç®¡ç†
- ã‚³ãƒ¼ã‚¹ãƒ»ãƒ¬ãƒƒã‚¹ãƒ³ç®¡ç†
- è³‡æ–™ç®¡ç†
- FAQç®¡ç†
- ãŠå•ã„åˆã‚ã›ç®¡ç†
- å ±é…¬ç®¡ç†
- æ˜‡æ ¼ç”³è«‹ç®¡ç†
- LPé¢è«‡ç®¡ç†
- ååˆºæ³¨æ–‡ç®¡ç†
- **ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ãƒ†ã‚¹ãƒˆç®¡ç†** â† NEW
- **äº‹å‰ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆç®¡ç†** â† NEW
- **å€‹åˆ¥ç›¸è«‡ç®¡ç†** â† NEW

---

## ğŸš¨ æ—¢çŸ¥ã®å•é¡Œç‚¹

### é«˜å„ªå…ˆåº¦

#### 1. ã‚¤ãƒ™ãƒ³ãƒˆè©³ç´°ãƒšãƒ¼ã‚¸ã®æ¬ å¦‚

**å•é¡Œ:**
- ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ã‚¤ãƒ™ãƒ³ãƒˆè©³ç´°ãƒšãƒ¼ã‚¸ãŒæœªå®Ÿè£…
- ã‚¤ãƒ™ãƒ³ãƒˆä¸€è¦§ã‹ã‚‰è©³ç´°ã«é·ç§»ã§ããªã„
- é€šçŸ¥ã‹ã‚‰ä¸€è¦§ãƒšãƒ¼ã‚¸ã«ã—ã‹é·ç§»ã—ãªã„

**å½±éŸ¿:**
- ã‚¤ãƒ™ãƒ³ãƒˆè©³ç´°æƒ…å ±ã‚’ç¢ºèªã§ããªã„
- éå»ã‚¤ãƒ™ãƒ³ãƒˆã®å†™çœŸãƒ»è³‡æ–™ã‚’é–²è¦§ã§ããªã„

**å¯¾å¿œäºˆå®š:**
- `/dashboard/events/[eventId]/page.tsx` ã‚’å®Ÿè£…
- è©³ç´°è¡¨ç¤ºã€å‚åŠ ç™»éŒ²ã€å‡ºå¸­ç¢ºèªæ©Ÿèƒ½ã‚’è¿½åŠ 

### ä¸­å„ªå…ˆåº¦

#### 2. ä¼šå“¡ç•ªå·ã®å¿…é ˆåŒ–

**ç¾çŠ¶:**
- `memberId String? @unique`ï¼ˆnullableï¼‰

**å¯¾å¿œäºˆå®š:**
- å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®ä»˜ä¸å®Œäº†å¾Œã€å¿…é ˆåŒ–
- schema.prisma æ›´æ–°

#### 3. middleware.ts ã®å®Ÿè£…

**ç›®çš„:**
- ã‚°ãƒ­ãƒ¼ãƒãƒ«ãªèªè¨¼ãƒ»èªå¯ãƒã‚§ãƒƒã‚¯
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£å¼·åŒ–

**å¯¾å¿œäºˆå®š:**
- èªè¨¼ãƒã‚§ãƒƒã‚¯
- ãƒ­ãƒ¼ãƒ«åˆ¥ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡

### ä½å„ªå…ˆåº¦

#### 4. ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ã®æ•´ç†

**ç¾çŠ¶:**
- æœ¬ç•ªç’°å¢ƒã§ã‚‚ãƒ‡ãƒãƒƒã‚°ãƒ­ã‚°ãŒå‡ºåŠ›ã•ã‚Œã‚‹

**å¯¾å¿œäºˆå®š:**
- ç’°å¢ƒå¤‰æ•°ã§ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«åˆ¶å¾¡

---

## ğŸ“Š æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
- Next.js 15 (App Router)
- React 19
- TypeScript 5
- Tailwind CSS 4
- Radix UI + shadcn/ui
- Lucide React

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
- Next.js API Routes
- PostgreSQL (Supabase)
- Prisma 6
- Supabase Auth
- Supabase Storage
- Stripe

---

## ğŸ¯ ã‚·ã‚¹ãƒ†ãƒ çµ±è¨ˆ

- **å®Ÿè£…æ©Ÿèƒ½æ•°**: 23ä»¥ä¸Š
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ¢ãƒ‡ãƒ«**: 40ä»¥ä¸Š
- **APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ**: 160ä»¥ä¸Š
- **ãƒšãƒ¼ã‚¸æ•°**: 70ãƒšãƒ¼ã‚¸ä»¥ä¸Š
- **ã‚³ãƒ¼ãƒ‰è¡Œæ•°**: ç´„60,000è¡Œ

---

## ğŸ“ æ›´æ–°å±¥æ­´

- **2025-12-01**: ãƒãƒ¼ã‚¸ãƒ§ãƒ³2.0ã«æ›´æ–°
  - ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ãƒ†ã‚¹ãƒˆæ©Ÿèƒ½ã‚’è¿½åŠ ï¼ˆã‚»ã‚¯ã‚·ãƒ§ãƒ³13ï¼‰
  - äº‹å‰ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆæ©Ÿèƒ½ã‚’è¿½åŠ ï¼ˆã‚»ã‚¯ã‚·ãƒ§ãƒ³14ï¼‰
  - å€‹åˆ¥ç›¸è«‡æ©Ÿèƒ½ã‚’è¿½åŠ ï¼ˆã‚»ã‚¯ã‚·ãƒ§ãƒ³15ï¼‰
  - LPé¢è«‡æ©Ÿèƒ½ã®æ›´æ–°ï¼ˆNO_SHOWã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã€å†ç”³è«‹æ©Ÿèƒ½ï¼‰
  - FPæ˜‡æ ¼ãƒ•ãƒ­ãƒ¼ã«ã‚³ãƒ³ãƒ—ãƒ©ã‚¤ã‚¢ãƒ³ã‚¹ãƒ†ã‚¹ãƒˆã‚’è¿½åŠ 
  - ãƒ­ãƒ¼ãƒ«å¤‰æ›´æ™‚ã®ãƒ‡ãƒ¼ã‚¿ãƒªã‚»ãƒƒãƒˆãƒ­ã‚¸ãƒƒã‚¯ã‚’æ–‡æ›¸åŒ–
  - ã‚»ã‚¯ã‚·ãƒ§ãƒ³ç•ªå·ã‚’å†ç·¨æˆï¼ˆ16-21ã«å¤‰æ›´ï¼‰

- **2025-01-25**: å®Ÿè£…ãƒ™ãƒ¼ã‚¹ã§å…¨é¢æ”¹è¨‚ï¼ˆãƒãƒ¼ã‚¸ãƒ§ãƒ³1.0ï¼‰
  - å®Ÿéš›ã®å®Ÿè£…çŠ¶æ³ã‚’åæ˜ 
  - æ—¢çŸ¥ã®å•é¡Œç‚¹ã‚’æ˜è¨˜
  - ä¼šå“¡ç•ªå·æ©Ÿèƒ½ã®è©³ç´°ã‚’è¿½åŠ 
  - ååˆºæ³¨æ–‡æ©Ÿèƒ½ã‚’è¿½åŠ 

---

## ğŸ”— é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- [README.md](./README.md) - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦
- [REQUIREMENTS.md](./REQUIREMENTS.md) - è¦ä»¶å®šç¾©æ›¸
- [prisma/schema.prisma](./prisma/schema.prisma) - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒ

---

**ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯å®Ÿè£…ãƒ™ãƒ¼ã‚¹ã§ä½œæˆã•ã‚Œã¦ã„ã¾ã™ã€‚**
**ä»•æ§˜æ›¸ã¨ã®å·®åˆ†ãŒã‚ã‚‹å ´åˆã€ç¾åœ¨ã®å®Ÿè£…ãŒå„ªå…ˆã•ã‚Œã¾ã™ã€‚**
